(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const a of i)if(a.type==="childList")for(const r of a.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&s(r)}).observe(document,{childList:!0,subtree:!0});function t(i){const a={};return i.integrity&&(a.integrity=i.integrity),i.referrerPolicy&&(a.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?a.credentials="include":i.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function s(i){if(i.ep)return;i.ep=!0;const a=t(i);fetch(i.href,a)}})();const $={lang_native_name:"English",score:"Score",level:"Level",lives:"Lives",highscore:"Highscore",main_menu_title:"MAIN MENU",pause_header:"PAUSE",energy:"Energy",tab_spiel:"Game",tab_arsenal:"Arsenal",tab_gegner:"Enemies",tab_einstellungen:"Settings",btn_resume:"Resume",btn_start_game:"START GAME",btn_restart:"Restart",btn_quit:"Quit to Menu",btn_quit_to_menu:"Quit to Menu",btn_exit:"EXIT GAME",btn_back:"Back",settings_language_label:"Language",settings_language_desc:"Changes the display language of the game.",settings_volume_label:"Master Volume",settings_volume_desc:"Controls the overall volume of the game.",settings_music_label:"Music",settings_music_desc:"Toggles the background music on or off.",settings_sfx_label:"SFX",settings_sfx_desc:"Toggles sound effects like shots and explosions on or off.",settings_particles_label:"Particles",settings_particles_desc:"Sets the amount of particle effects for explosions (HIGH, LOW, OFF).",settings_shake_label:"Screen Shake",settings_shake_desc:"Enables or disables screen shake on hits and explosions.",arsenal_cat_weapon_upgrade:"Weapon Upgrade",arsenal_cat_weapon_mod:"Weapon Mod",arsenal_cat_ultra_weapon:"Ultra Weapons (Inventory)",arsenal_cat_defense:"Defense",arsenal_cat_special:"Specials (Inventory)",powerup_wup_name:"Weapon Tier Up (W+)",powerup_wup_desc:"Increases weapon tier. Tier 2 (90s), 3 (60s) & 4 (30s) are timed and downgrade on expiration. Lose a tier on any hit (min. Tier 1).",powerup_rapid_fire_name:"Rapid Fire",powerup_rapid_fire_desc:"Significantly increases fire rate for 30 seconds.",powerup_side_shots_name:"Side Shots",powerup_side_shots_desc:"Fires additional shots to the sides, regardless of the active power-up. Active for 15 seconds.",powerup_laser_name:"Laser Beam",powerup_laser_desc:"Collects a Laser Beam in the Ultra Inventory. Fires a piercing energy beam for 10 seconds. Activate with key 4 or 5.",powerup_homing_missiles_name:"Homing Missiles",powerup_homing_missiles_desc:"Collects Homing Missiles in the Ultra Inventory. Fires seeking missiles for 15 seconds. Activate with key 4 or 5.",powerup_shield_name:"Shield",powerup_shield_desc:"Absorbs one hit. Lasts 15 seconds or until hit.",powerup_repair_kit_name:"Repair Kit",powerup_repair_kit_desc:"Fully restores the ship's energy.",powerup_extra_life_name:"Extra Life",powerup_extra_life_desc:"Instantly grants one extra life, up to the maximum allowed.",powerup_ghost_protocol_name:"Ghost Protocol",powerup_ghost_protocol_desc:"Makes the ship invulnerable and immune to collisions for a short time.",powerup_orbital_drone_name:"Orbital Drone",powerup_orbital_drone_desc:"Collects an autonomous combat drone. Up to 3 drones are active for 30s. Each new drone resets the timer for all.",powerup_nuke_name:"Nuke",powerup_nuke_desc:"Instantly destroys all visible standard enemies. Activate with key 1, 2, or 3.",powerup_black_hole_name:"Black Hole",powerup_black_hole_desc:"Creates a black hole. Hold key 1, 2, or 3 to aim and release to deploy. Pulls in enemies (boss-immune).",powerup_score_boost_name:"Score Boost",powerup_score_boost_desc:"Doubles all points collected for 20 seconds. Activate with key 1, 2, or 3.",gegner_header:"Hostile Units",gegner_grunt_name:"Grunt",gegner_grunt_desc:"Standard infantry. Flies in a straight line and is the most basic threat.",gegner_weaver_name:"Weaver",gegner_weaver_desc:"Moves in unpredictable sine waves and is difficult to hit.",gegner_tank_name:"Tank",gegner_tank_desc:"Slow but heavily armored. Withstands multiple hits and deals increased collision damage.",gegner_shooter_name:"Shooter",gegner_shooter_desc:"Regularly fires single projectiles at the player. A high priority target.",gegner_sentinel_prime_name:"Sentinel Prime",gegner_sentinel_prime_desc:"A patrol craft with varied attacks, including spreads, spirals, and a dangerous charge attack.",gegner_void_serpent_name:"Void Serpent",gegner_void_serpent_desc:"A massive leviathan that moves in a wide, serpentine pattern, firing wide volleys and targeted whips.",gegner_omega_nexus_name:"Omega Nexus",gegner_omega_nexus_desc:"A fortress-like war engine. Its attack patterns change with damage, culminating in a powerful laser beam.",gegner_nexus_prime_name:"Nexus Prime (Final)",gegner_nexus_prime_desc:"The ultimate form of the Nexus. Features a sweeping laser, indestructible drones, and a relentless bullet hell.",strength_low:"Low",strength_medium:"Medium",strength_high:"High",strength_extreme:"Extreme",strength_apocalyptic:"Apocalyptic",strength_final:"FINAL",wave_msg_1:"Wave 1: Invasion",wave_msg_2:"Wave 2: Weavers Sighted",wave_msg_3:"Wave 3: Heavy Units",wave_msg_4:"Wave 4: Return Fire!",wave_msg_5:"BOSS: SENTINEL PRIME",wave_msg_6:"Wave 6: Bullet Hail",wave_msg_7:"Wave 7: Armored Dancers",wave_msg_8:"Wave 8: Combined Assault",wave_msg_9:"Wave 9: Escalation",wave_msg_10:"BOSS: VOID SERPENT",wave_msg_11:"Wave 11: The Swarm",wave_msg_12:"Wave 12: Steel Wall",wave_msg_13:"Wave 13: Unpredictable",wave_msg_14:"Wave 14: Elite Guard",wave_msg_15:"BOSS: OMEGA NEXUS",wave_msg_16:"Wave 16: Endless Ranks",wave_msg_17:"Wave 17: Pure Chaos",wave_msg_18:"Wave 18: Total Offensive",wave_msg_19:"Wave 19: Inferno",wave_msg_20:"FINAL BOSS: NEXUS PRIME",game_over_title:"GAME OVER",game_over_final_score:"Final Score",game_over_prompt:"",victory_title:"VICTORY!",victory_final_score:"Final Score",victory_prompt:"Press ENTER to return to Menu",intro_prompt:"Press ENTER to Begin",intro_prompt_mobile:"Tap to Start Game",lang_select_title:"SELECT LANGUAGE",w_tier:"W-Tier",off:"OFF",low:"LOW",high:"HIGH",on:"ON",buff_rf:"RF",buff_sideshots:"W<>",buff_orbital:"O"},j={lang_native_name:"Deutsch",score:"Punkte",level:"Level",lives:"Leben",highscore:"Highscore",main_menu_title:"HAUPTMENÜ",pause_header:"PAUSE",energy:"Energie",tab_spiel:"Spiel",tab_arsenal:"Arsenal",tab_gegner:"Gegner",tab_einstellungen:"Einstellungen",btn_resume:"Fortsetzen",btn_start_game:"SPIEL STARTEN",btn_restart:"Neu starten",btn_quit:"Zum Hauptmenü",btn_quit_to_menu:"Zum Menü",btn_exit:"SPIEL BEENDEN",btn_back:"Zurück",settings_language_label:"Sprache",settings_language_desc:"Ändert die Anzeigesprache des Spiels.",settings_volume_label:"Master-Lautstärke",settings_volume_desc:"Steuert die Gesamtlautstärke des Spiels.",settings_music_label:"Musik",settings_music_desc:"Schaltet die Hintergrundmusik ein oder aus.",settings_sfx_label:"SFX",settings_sfx_desc:"Schaltet Soundeffekte wie Schüsse und Explosionen ein oder aus.",settings_particles_label:"Partikel",settings_particles_desc:"Stellt die Menge der Partikeleffekte für Explosionen ein (HOCH, NIEDRIG, AUS).",settings_shake_label:"Screen Shake",settings_shake_desc:"Aktiviert oder deaktiviert das Bildschirmwackeln bei Treffern und Explosionen.",arsenal_cat_weapon_upgrade:"Waffen-Upgrade",arsenal_cat_weapon_mod:"Waffen-Mod",arsenal_cat_ultra_weapon:"Ultra-Waffen (Inventar)",arsenal_cat_defense:"Verteidigung",arsenal_cat_special:"Spezial (Inventar)",powerup_wup_name:"Waffenstufe Up (W+)",powerup_wup_desc:"Erhöht die Waffenstufe. Stufe 2 (90s), 3 (60s) & 4 (30s) sind zeitlich begrenzt und fallen bei Ablauf ab. Bei jedem Treffer wird eine Stufe verloren (min. Stufe 1).",powerup_rapid_fire_name:"Schnellfeuer",powerup_rapid_fire_desc:"Erhöht die Schussfrequenz erheblich für 30 Sekunden.",powerup_side_shots_name:"Seitenschüsse",powerup_side_shots_desc:"Feuert zusätzlich zu den Seiten, egal welches Power-up aktiv ist. Aktiv für 15 Sekunden.",powerup_laser_name:"Laserstrahl",powerup_laser_desc:"Sammelt einen Laserstrahl im Ultra-Inventar. Feuert einen durchdringenden Energiestrahl für 10 Sekunden. Aktivierung mit Taste 4 oder 5.",powerup_homing_missiles_name:"Zielsuchende Raketen",powerup_homing_missiles_desc:"Sammelt zielsuchende Raketen im Ultra-Inventar. Feuert Raketen für 15 Sekunden. Aktivierung mit Taste 4 oder 5.",powerup_shield_name:"Schild",powerup_shield_desc:"Absorbiert einen Treffer. Hält 15 Sekunden oder bis er getroffen wird.",powerup_repair_kit_name:"Reparatur-Kit",powerup_repair_kit_desc:"Stellt die Energie des Schiffes vollständig wieder her.",powerup_extra_life_name:"Extra-Leben",powerup_extra_life_desc:"Gewährt sofort ein zusätzliches Leben, bis zum erlaubten Maximum.",powerup_ghost_protocol_name:"Geist-Protokoll",powerup_ghost_protocol_desc:"Macht das Schiff für kurze Zeit unverwundbar und immun gegen Kollisionen.",powerup_orbital_drone_name:"Orbital-Drohne",powerup_orbital_drone_desc:"Sammelt eine autonome Kampfdrohne. Bis zu 3 Drohnen sind für 30s aktiv. Jede neue Drohne setzt den Timer für alle zurück.",powerup_nuke_name:"Nuke",powerup_nuke_desc:"Zerstört sofort alle sichtbaren Standard-Gegner. Aktivierung mit Taste 1, 2 oder 3.",powerup_black_hole_name:"Schwarzes Loch",powerup_black_hole_desc:"Erzeugt ein Schwarzes Loch. Zum Zielen Taste 1, 2 oder 3 gedrückt halten und zum Platzieren loslassen. Zieht Gegner an (Boss-immun).",powerup_score_boost_name:"Punkte-Boost",powerup_score_boost_desc:"Verdoppelt alle gesammelten Punkte für 20 Sekunden. Aktivierung mit Taste 1, 2 oder 3.",gegner_header:"Feindliche Einheiten",gegner_grunt_name:"Grunt",gegner_grunt_desc:"Standard-Infanterie. Fliegt geradlinig und stellt die grundlegendste Bedrohung dar.",gegner_weaver_name:"Weaver",gegner_weaver_desc:"Bewegt sich in unvorhersehbaren Sinuswellen und ist schwer zu treffen.",gegner_tank_name:"Tank",gegner_tank_desc:"Langsam, aber stark gepanzert. Hält mehrere Treffer aus und verursacht bei Kollision erhöhten Schaden.",gegner_shooter_name:"Shooter",gegner_shooter_desc:"Feuert regelmäßig einzelne Projektile auf den Spieler. Eine hohe Priorität beim Ausschalten.",gegner_sentinel_prime_name:"Sentinel Prime",gegner_sentinel_prime_desc:"Ein Patrouillenschiff mit vielfältigen Angriffen, darunter Fächer, Spiralen und ein gefährlicher Sturzangriff.",gegner_void_serpent_name:"Leeren-Serpent",gegner_void_serpent_desc:"Ein massiver Leviathan, der sich in weiten Schlangenlinien bewegt und breite Salven sowie gezielte Peitschenhiebe abfeuert.",gegner_omega_nexus_name:"Omega Nexus",gegner_omega_nexus_desc:"Eine festungsartige Kriegsmaschine. Seine Angriffsmuster ändern sich mit dem erlittenen Schaden und gipfeln in einem mächtigen Laserstrahl.",gegner_nexus_prime_name:"Nexus Prime (Final)",gegner_nexus_prime_desc:"Die ultimative Form des Nexus. Verfügt über einen fegenden Laser, unzerstörbare Drohnen und einen unerbittlichen Kugelhagel.",strength_low:"Niedrig",strength_medium:"Mittel",strength_high:"Hoch",strength_extreme:"Extrem",strength_apocalyptic:"Apokalyptisch",strength_final:"FINAL",wave_msg_1:"Welle 1: Invasion",wave_msg_2:"Welle 2: Weber gesichtet",wave_msg_3:"Welle 3: Schwere Einheiten",wave_msg_4:"Welle 4: Gegenfeuer!",wave_msg_5:"BOSS: SENTINEL PRIME",wave_msg_6:"Welle 6: Kugelhagel",wave_msg_7:"Welle 7: Gepanzerte Tänzer",wave_msg_8:"Welle 8: Kombinierter Angriff",wave_msg_9:"Welle 9: Eskalation",wave_msg_10:"BOSS: LEEREN-SERPENT",wave_msg_11:"Welle 11: Der Schwarm",wave_msg_12:"Welle 12: Stahlwand",wave_msg_13:"Welle 13: Unberechenbar",wave_msg_14:"Welle 14: Elite-Garde",wave_msg_15:"BOSS: OMEGA NEXUS",wave_msg_16:"Welle 16: Endlose Reihen",wave_msg_17:"Welle 17: Chaos pur",wave_msg_18:"Welle 18: Totale Offensive",wave_msg_19:"Welle 19: Inferno",wave_msg_20:"FINALER BOSS: NEXUS PRIME",game_over_title:"SPIEL VORBEI",game_over_final_score:"Endstand",game_over_prompt:"",victory_title:"SIEG!",victory_final_score:"Endstand",victory_prompt:"ENTER drücken, um zum Menü zurückzukehren",intro_prompt:"ENTER drücken zum Starten",intro_prompt_mobile:"Tippen zum Starten",lang_select_title:"SPRACHE WÄHLEN",w_tier:"W-Stufe",off:"AUS",low:"NIEDRIG",high:"HOCH",on:"AN",buff_rf:"SF",buff_sideshots:"S<>",buff_orbital:"O"},J={lang_native_name:"Español",score:"Puntuación",level:"Nivel",lives:"Vidas",highscore:"Puntuación Máxima",main_menu_title:"MENÚ PRINCIPAL",pause_header:"PAUSA",energy:"Energía",tab_spiel:"Juego",tab_arsenal:"Arsenal",tab_gegner:"Enemigos",tab_einstellungen:"Ajustes",btn_resume:"Reanudar",btn_start_game:"INICIAR JUEGO",btn_restart:"Reiniciar",btn_quit:"Salir al Menú",btn_quit_to_menu:"Salir al Menú",btn_exit:"SALIR DEL JUEGO",btn_back:"Volver",settings_language_label:"Idioma",settings_language_desc:"Cambia el idioma de visualización del juego.",settings_volume_label:"Volumen Principal",settings_volume_desc:"Controla el volumen general del juego.",settings_music_label:"Música",settings_music_desc:"Activa o desactiva la música de fondo.",settings_sfx_label:"Efectos de Sonido",settings_sfx_desc:"Activa o desactiva los efectos de sonido como disparos y explosiones.",settings_particles_label:"Partículas",settings_particles_desc:"Establece la cantidad de efectos de partículas para las explosiones (ALTO, BAJO, NO).",settings_shake_label:"Vibración de Pantalla",settings_shake_desc:"Activa o desactiva la vibración de la pantalla con los impactos y explosiones.",arsenal_cat_weapon_upgrade:"Mejora de Arma",arsenal_cat_weapon_mod:"Mod de Arma",arsenal_cat_ultra_weapon:"Ultra Armas (Inventario)",arsenal_cat_defense:"Defensa",arsenal_cat_special:"Especiales (Inventario)",powerup_wup_name:"Subir Nivel de Arma (W+)",powerup_wup_desc:"Aumenta el nivel del arma. Nivel 2 (90s), 3 (60s) y 4 (30s) son temporales y bajan al expirar. Se pierde un nivel al recibir un impacto (mín. Nivel 1).",powerup_rapid_fire_name:"Fuego Rápido",powerup_rapid_fire_desc:"Aumenta significativamente la cadencia de fuego durante 30 segundos.",powerup_side_shots_name:"Disparos Laterales",powerup_side_shots_desc:"Dispara proyectiles adicionales hacia los lados, independientemente del poder activo. Dura 15 segundos.",powerup_laser_name:"Rayo Láser",powerup_laser_desc:"Recoge un Rayo Láser en el Inventario Ultra. Dispara un rayo de energía perforante durante 10 segundos. Activar con la tecla 4 o 5.",powerup_homing_missiles_name:"Misiles Teledirigidos",powerup_homing_missiles_desc:"Recoge Misiles Teledirigidos en el Inventario Ultra. Dispara misiles que buscan enemigos durante 15 segundos. Activar con la tecla 4 o 5.",powerup_shield_name:"Escudo",powerup_shield_desc:"Absorbe un impacto. Dura 15 segundos o hasta ser golpeado.",powerup_repair_kit_name:"Kit de Reparación",powerup_repair_kit_desc:"Restaura completamente la energía de la nave.",powerup_extra_life_name:"Vida Extra",powerup_extra_life_desc:"Otorga instantáneamente una vida extra, hasta el máximo permitido.",powerup_ghost_protocol_name:"Protocolo Fantasma",powerup_ghost_protocol_desc:"Hace que la nave sea invulnerable e inmune a las colisiones por un corto tiempo.",powerup_orbital_drone_name:"Dron Orbital",powerup_orbital_drone_desc:"Recoge un dron de combate autónomo. Hasta 3 drones están activos por 30s. Cada nuevo dron reinicia el temporizador para todos.",powerup_nuke_name:"Bomba Nuclear",powerup_nuke_desc:"Destruye instantáneamente a todos los enemigos estándar visibles. Activar con la tecla 1, 2 o 3.",powerup_black_hole_name:"Agujero Negro",powerup_black_hole_desc:"Crea un agujero negro. Mantén presionada la tecla 1, 2 o 3 para apuntar y suéltala para desplegarlo. Atrae a los enemigos (inmune a jefes).",powerup_score_boost_name:"Multiplicador de Puntos",powerup_score_boost_desc:"Duplica todos los puntos obtenidos durante 20 segundos. Activar con la tecla 1, 2 o 3.",gegner_header:"Unidades Hostiles",gegner_grunt_name:"Grunt",gegner_grunt_desc:"Infantería estándar. Vuela en línea recta y es la amenaza más básica.",gegner_weaver_name:"Weaver",gegner_weaver_desc:"Se mueve en ondas sinusoidales impredecibles y es difícil de golpear.",gegner_tank_name:"Tank",gegner_tank_desc:"Lento pero muy blindado. Soporta múltiples impactos y causa mayor daño por colisión.",gegner_shooter_name:"Shooter",gegner_shooter_desc:"Dispara proyectiles individuales al jugador regularmente. Un objetivo de alta prioridad.",gegner_sentinel_prime_name:"Sentinel Prime",gegner_sentinel_prime_desc:"Una nave de patrulla con ataques variados, incluyendo ráfagas, espirales y un peligroso ataque de carga.",gegner_void_serpent_name:"Serpiente del Vacío",gegner_void_serpent_desc:"Un leviatán masivo que se mueve en un amplio patrón de serpentina, disparando andanadas y latigazos dirigidos.",gegner_omega_nexus_name:"Omega Nexus",gegner_omega_nexus_desc:"Una máquina de guerra tipo fortaleza. Sus patrones de ataque cambian con el daño, culminando en un potente rayo láser.",gegner_nexus_prime_name:"Nexus Prime (Final)",gegner_nexus_prime_desc:"La forma definitiva del Nexus. Cuenta con un láser de barrido, drones indestructibles y una lluvia de balas implacable.",strength_low:"Bajo",strength_medium:"Medio",strength_high:"Alto",strength_extreme:"Extremo",strength_apocalyptic:"Apocalíptico",strength_final:"FINAL",wave_msg_1:"Oleada 1: Invasión",wave_msg_2:"Oleada 2: Weavers Avistados",wave_msg_3:"Oleada 3: Unidades Pesadas",wave_msg_4:"Oleada 4: ¡Devuelvan el Fuego!",wave_msg_5:"JEFE: SENTINEL PRIME",wave_msg_6:"Oleada 6: Lluvia de Balas",wave_msg_7:"Oleada 7: Bailarines Blindados",wave_msg_8:"Oleada 8: Asalto Combinado",wave_msg_9:"Oleada 9: Escalada",wave_msg_10:"JEFE: SERPIENTE DEL VACÍO",wave_msg_11:"Oleada 11: El Enjambre",wave_msg_12:"Oleada 12: Muro de Acero",wave_msg_13:"Oleada 13: Impredecible",wave_msg_14:"Oleada 14: Guardia de Élite",wave_msg_15:"JEFE: OMEGA NEXUS",wave_msg_16:"Oleada 16: Filas Interminables",wave_msg_17:"Oleada 17: Caos Puro",wave_msg_18:"Oleada 18: Ofensiva Total",wave_msg_19:"Oleada 19: Infierno",wave_msg_20:"JEFE FINAL: NEXUS PRIME",game_over_title:"FIN DEL JUEGO",game_over_final_score:"Puntuación Final",game_over_prompt:"",victory_title:"¡VICTORIA!",victory_final_score:"Puntuación Final",victory_prompt:"Presiona ENTER para volver al Menú",intro_prompt:"Presiona ENTER para Empezar",intro_prompt_mobile:"Toca para Empezar",lang_select_title:"SELECCIONAR IDIOMA",w_tier:"N-Arma",off:"NO",low:"BAJO",high:"ALTO",on:"SÍ",buff_rf:"FR",buff_sideshots:"D<>",buff_orbital:"O"},Z={lang_native_name:"中文",score:"分数",level:"等级",lives:"生命",highscore:"最高分",main_menu_title:"主菜单",pause_header:"暂停",energy:"能量",tab_spiel:"游戏",tab_arsenal:"武器库",tab_gegner:"敌人",tab_einstellungen:"设置",btn_resume:"继续",btn_start_game:"开始游戏",btn_restart:"重新开始",btn_quit:"退出到菜单",btn_quit_to_menu:"退出到菜单",btn_exit:"退出游戏",btn_back:"返回",settings_language_label:"语言",settings_language_desc:"更改游戏的显示语言。",settings_volume_label:"主音量",settings_volume_desc:"控制游戏的整体音量。",settings_music_label:"音乐",settings_music_desc:"切换背景音乐的开启或关闭。",settings_sfx_label:"音效",settings_sfx_desc:"切换射击和爆炸等音效的开启或关闭。",settings_particles_label:"粒子效果",settings_particles_desc:"设置爆炸的粒子效果数量（高、低、关）。",settings_shake_label:"屏幕震动",settings_shake_desc:"启用或禁用命中和爆炸时的屏幕震动。",arsenal_cat_weapon_upgrade:"武器升级",arsenal_cat_weapon_mod:"武器模组",arsenal_cat_ultra_weapon:"超级武器（库存）",arsenal_cat_defense:"防御",arsenal_cat_special:"特殊技能（库存）",powerup_wup_name:"武器等级提升 (W+)",powerup_wup_desc:"提升武器等级。等级2（90秒）、3（60秒）和4（30秒）有时间限制，到期后降级。受到任何攻击都会降低一级（最低为1级）。",powerup_rapid_fire_name:"快速射击",powerup_rapid_fire_desc:"在30秒内显著提高射速。",powerup_side_shots_name:"侧向射击",powerup_side_shots_desc:"无论当前激活了何种能量提升，都会向侧面发射额外的子弹。持续15秒。",powerup_laser_name:"激光束",powerup_laser_desc:"在超级武器库中收集一个激光束。发射一道穿透性能量束，持续10秒。按4或5键激活。",powerup_homing_missiles_name:"追踪导弹",powerup_homing_missiles_desc:"在超级武器库中收集追踪导弹。发射追踪导弹，持续15秒。按4或5键激活。",powerup_shield_name:"护盾",powerup_shield_desc:"吸收一次攻击。持续15秒或直到被击中。",powerup_repair_kit_name:"修理包",powerup_repair_kit_desc:"完全恢复飞船的能量。",powerup_extra_life_name:"额外生命",powerup_extra_life_desc:"立即授予一条额外生命，直至达到允许的上限。",powerup_ghost_protocol_name:"幽灵协议",powerup_ghost_protocol_desc:"使飞船在短时间内无敌并免疫碰撞。",powerup_orbital_drone_name:"轨道无人机",powerup_orbital_drone_desc:"收集一个自主战斗无人机。最多3架无人机可激活30秒。每收集一架新的无人机都会重置所有无人机的时间。",powerup_nuke_name:"核弹",powerup_nuke_desc:"立即摧毁所有可见的普通敌人。按1、2或3键激活。",powerup_black_hole_name:"黑洞",powerup_black_hole_desc:"创建一个黑洞。按住1、2或3键瞄准，松开部署。吸引敌人（对Boss无效）。",powerup_score_boost_name:"分数加倍",powerup_score_boost_desc:"在20秒内使所有获得的分数加倍。按1、2或3键激活。",gegner_header:"敌方单位",gegner_grunt_name:"咕噜兵",gegner_grunt_desc:"标准步兵。直线飞行，是最基本的威胁。",gegner_weaver_name:"织布者",gegner_weaver_desc:"以不可预测的正弦波移动，难以击中。",gegner_tank_name:"坦克",gegner_tank_desc:"速度慢但装甲厚重。能承受多次攻击并造成更高的碰撞伤害。",gegner_shooter_name:"射手",gegner_shooter_desc:"定期向玩家发射单个射弹。是高优先级目标。",gegner_sentinel_prime_name:"哨兵Prime",gegner_sentinel_prime_desc:"一艘巡逻艇，具有多种攻击方式，包括散弹、螺旋弹和危险的冲锋攻击。",gegner_void_serpent_name:"虚空之蛇",gegner_void_serpent_desc:"一条巨大的利维坦，以宽阔的蛇形模式移动，发射宽阔的齐射和有针对性的鞭击。",gegner_omega_nexus_name:"欧米茄核心",gegner_omega_nexus_desc:"一个堡垒般的战争机器。其攻击模式会随着受到的伤害而改变，最终以强大的激光束告终。",gegner_nexus_prime_name:"核心Prime (最终)",gegner_nexus_prime_desc:"核心的最终形态。具有扫射激光、坚不可摧的无人机和无情的弹幕地狱。",strength_low:"低",strength_medium:"中",strength_high:"高",strength_extreme:"极高",strength_apocalyptic:"末日",strength_final:"最终",wave_msg_1:"第1波: 入侵",wave_msg_2:"第2波: 发现织布者",wave_msg_3:"第3波: 重型单位",wave_msg_4:"第4波: 还击！",wave_msg_5:"BOSS: 哨兵PRIME",wave_msg_6:"第6波: 弹雨",wave_msg_7:"第7波: 装甲舞者",wave_msg_8:"第8波: 联合攻击",wave_msg_9:"第9波: 升级",wave_msg_10:"BOSS: 虚空之蛇",wave_msg_11:"第11波: 虫群",wave_msg_12:"第12波: 钢墙",wave_msg_13:"第13波: 不可预测",wave_msg_14:"第14波: 精英卫队",wave_msg_15:"BOSS: 欧米茄核心",wave_msg_16:"第16波: 无尽的行列",wave_msg_17:"第17波: 纯粹的混乱",wave_msg_18:"第18波: 全面进攻",wave_msg_19:"第19波: 地狱火",wave_msg_20:"最终BOSS: 核心PRIME",game_over_title:"游戏结束",game_over_final_score:"最终分数",game_over_prompt:"",victory_title:"胜利！",victory_final_score:"最终分数",victory_prompt:"按 ENTER 返回菜单",intro_prompt:"按 ENTER 开始",intro_prompt_mobile:"点击开始",lang_select_title:"选择语言",w_tier:"武器等级",off:"关",low:"低",high:"高",on:"开",buff_rf:"速射",buff_sideshots:"侧射",buff_orbital:"浮游"},Q={lang_native_name:"日本語",score:"スコア",level:"レベル",lives:"残機",highscore:"ハイスコア",main_menu_title:"メインメニュー",pause_header:"一時停止",energy:"エネルギー",tab_spiel:"ゲーム",tab_arsenal:"アーセナル",tab_gegner:"敵",tab_einstellungen:"設定",btn_resume:"再開",btn_start_game:"ゲーム開始",btn_restart:"リスタート",btn_quit:"メニューに戻る",btn_quit_to_menu:"メニューに戻る",btn_exit:"ゲームを終了",btn_back:"戻る",settings_language_label:"言語",settings_language_desc:"ゲームの表示言語を変更します。",settings_volume_label:"マスター音量",settings_volume_desc:"ゲーム全体の音量を調整します。",settings_music_label:"音楽",settings_music_desc:"BGMのオン/オフを切り替えます。",settings_sfx_label:"効果音",settings_sfx_desc:"ショットや爆発などの効果音のオン/オフを切り替えます。",settings_particles_label:"パーティクル",settings_particles_desc:"爆発のパーティクルエフェクトの量を設定します（高、低、オフ）。",settings_shake_label:"画面の揺れ",settings_shake_desc:"ヒット時や爆発時の画面の揺れを有効/無効にします。",arsenal_cat_weapon_upgrade:"武器アップグレード",arsenal_cat_weapon_mod:"武器MOD",arsenal_cat_ultra_weapon:"ウルトラウェポン（インベントリ）",arsenal_cat_defense:"防御",arsenal_cat_special:"スペシャル（インベントリ）",powerup_wup_name:"武器ティアアップ (W+)",powerup_wup_desc:"武器のティアを上げます。ティア2（90秒）、3（60秒）、4（30秒）は時間制で、時間切れでダウングレードします。被弾するとティアが1つ下がります（最低ティア1）。",powerup_rapid_fire_name:"ラピッドファイア",powerup_rapid_fire_desc:"30秒間、連射速度が大幅に向上します。",powerup_side_shots_name:"サイドショット",powerup_side_shots_desc:"アクティブなパワーアップに関係なく、左右に追加のショットを発射します。15秒間有効。",powerup_laser_name:"レーザービーム",powerup_laser_desc:"ウルトラインベントリにレーザービームを収集します。10秒間、貫通エネルギービームを発射します。キー4または5で起動。",powerup_homing_missiles_name:"ホーミングミサイル",powerup_homing_missiles_desc:"ウルトラインベントリにホーミングミサイルを収集します。15秒間、追尾ミサイルを発射します。キー4または5で起動。",powerup_shield_name:"シールド",powerup_shield_desc:"一回の攻撃を防ぎます。15秒間、または被弾するまで持続します。",powerup_repair_kit_name:"リペアキット",powerup_repair_kit_desc:"船のエネルギーを完全に回復します。",powerup_extra_life_name:"エクストラライフ",powerup_extra_life_desc:"即座に残機を1つ増やします（最大許容数まで）。",powerup_ghost_protocol_name:"ゴーストプロトコル",powerup_ghost_protocol_desc:"短時間、船を無敵にし、衝突の影響を受けなくします。",powerup_orbital_drone_name:"オービタルドローン",powerup_orbital_drone_desc:"自律戦闘ドローンを収集します。最大3機が30秒間活動します。新しいドローンを取得すると、すべてのタイマーがリセットされます。",powerup_nuke_name:"ニューク",powerup_nuke_desc:"画面上のすべての通常敵を即座に破壊します。キー1、2、または3で起動。",powerup_black_hole_name:"ブラックホール",powerup_black_hole_desc:"ブラックホールを生成します。キー1、2、または3を長押しして狙いを定め、離して展開します。敵を引き寄せます（ボスには無効）。",powerup_score_boost_name:"スコアブースト",powerup_score_boost_desc:"20秒間、獲得するすべてのポイントが2倍になります。キー1、2、または3で起動。",gegner_header:"敵ユニット",gegner_grunt_name:"グラント",gegner_grunt_desc:"標準的な歩兵。直線的に飛行する最も基本的な脅威です。",gegner_weaver_name:"ウィーバー",gegner_weaver_desc:"予測不可能なサイン波で動き、命中させるのが困難です。",gegner_tank_name:"タンク",gegner_tank_desc:"遅いが重装甲。複数回のヒットに耐え、衝突ダメージが増加します。",gegner_shooter_name:"シューター",gegner_shooter_desc:"定期的に単発の弾をプレイヤーに向けて発射します。優先度の高いターゲットです。",gegner_sentinel_prime_name:"センティネル・プライム",gegner_sentinel_prime_desc:"拡散弾、螺旋弾、危険な突撃攻撃など、多彩な攻撃を持つ巡視艇。",gegner_void_serpent_name:"ヴォイド・サーペント",gegner_void_serpent_desc:"広範囲に蛇行しながら移動し、広範囲の斉射と狙いを定めた鞭のような攻撃を放つ巨大なリヴァイアサン。",gegner_omega_nexus_name:"オメガ・ネクサス",gegner_omega_nexus_desc:"要塞のような戦闘機械。ダメージに応じて攻撃パターンが変化し、最終的には強力なレーザービームを放ちます。",gegner_nexus_prime_name:"ネクサス・プライム（最終）",gegner_nexus_prime_desc:"ネクサスの究極形態。掃射レーザー、破壊不能なドローン、そして容赦ない弾幕地獄が特徴です。",strength_low:"低",strength_medium:"中",strength_high:"高",strength_extreme:"極",strength_apocalyptic:"黙示録的",strength_final:"最終",wave_msg_1:"ウェーブ1：侵略",wave_msg_2:"ウェーブ2：ウィーバー発見",wave_msg_3:"ウェーブ3：重ユニット",wave_msg_4:"ウェーブ4：反撃せよ！",wave_msg_5:"ボス：センティネル・プライム",wave_msg_6:"ウェーブ6：弾丸の雹",wave_msg_7:"ウェーブ7：装甲の踊り手",wave_msg_8:"ウェーブ8：連携攻撃",wave_msg_9:"ウェーブ9：エスカレーション",wave_msg_10:"ボス：ヴォイド・サーペント",wave_msg_11:"ウェーブ11：スウォーム",wave_msg_12:"ウェーブ12：鋼鉄の壁",wave_msg_13:"ウェーブ13：予測不能",wave_msg_14:"ウェーブ14：エリートガード",wave_msg_15:"ボス：オメガ・ネクサス",wave_msg_16:"ウェーブ16：無限の軍勢",wave_msg_17:"ウェーブ17：純粋な混沌",wave_msg_18:"ウェーブ18：総攻撃",wave_msg_19:"ウェーブ19：インフェルノ",wave_msg_20:"最終ボス：ネクサス・プライム",game_over_title:"ゲームオーバー",game_over_final_score:"最終スコア",game_over_prompt:"",victory_title:"勝利！",victory_final_score:"最終スコア",victory_prompt:"ENTERキーでメニューに戻ります",intro_prompt:"ENTERキーで開始",intro_prompt_mobile:"タップして開始",lang_select_title:"言語を選択",w_tier:"Wティア",off:"オフ",low:"低",high:"高",on:"オン",buff_rf:"連射",buff_sideshots:"横",buff_orbital:"ド"},ee={lang_native_name:"Italiano",score:"Punteggio",level:"Livello",lives:"Vite",highscore:"Punteggio Massimo",main_menu_title:"MENU PRINCIPALE",pause_header:"PAUSA",energy:"Energia",tab_spiel:"Gioco",tab_arsenal:"Arsenale",tab_gegner:"Nemici",tab_einstellungen:"Impostazioni",btn_resume:"Riprendi",btn_start_game:"INIZIA PARTITA",btn_restart:"Ricomincia",btn_quit:"Esci al Menu",btn_quit_to_menu:"Esci al Menu",btn_exit:"ESCI DAL GIOCO",btn_back:"Indietro",settings_language_label:"Lingua",settings_language_desc:"Cambia la lingua di visualizzazione del gioco.",settings_volume_label:"Volume Principale",settings_volume_desc:"Controlla il volume generale del gioco.",settings_music_label:"Musica",settings_music_desc:"Attiva o disattiva la musica di sottofondo.",settings_sfx_label:"Effetti Sonori",settings_sfx_desc:"Attiva o disattiva gli effetti sonori come spari ed esplosioni.",settings_particles_label:"Particelle",settings_particles_desc:"Imposta la quantità di effetti particellari per le esplosioni (ALTO, BASSO, NO).",settings_shake_label:"Vibrazione Schermo",settings_shake_desc:"Abilita o disabilita la vibrazione dello schermo su colpi ed esplosioni.",arsenal_cat_weapon_upgrade:"Potenziamento Arma",arsenal_cat_weapon_mod:"Mod Arma",arsenal_cat_ultra_weapon:"Ultra Armi (Inventario)",arsenal_cat_defense:"Difesa",arsenal_cat_special:"Speciali (Inventario)",powerup_wup_name:"Aumento Livello Arma (W+)",powerup_wup_desc:"Aumenta il livello dell'arma. Livello 2 (90s), 3 (60s) e 4 (30s) sono a tempo e si riducono alla scadenza. Perdi un livello a ogni colpo subito (min. Livello 1).",powerup_rapid_fire_name:"Fuoco Rapido",powerup_rapid_fire_desc:"Aumenta significativamente la cadenza di fuoco per 30 secondi.",powerup_side_shots_name:"Colpi Laterali",powerup_side_shots_desc:"Spara colpi aggiuntivi ai lati, indipendentemente dal potenziamento attivo. Attivo per 15 secondi.",powerup_laser_name:"Raggio Laser",powerup_laser_desc:"Raccoglie un Raggio Laser nell'Inventario Ultra. Spara un raggio di energia perforante per 10 secondi. Attiva con il tasto 4 o 5.",powerup_homing_missiles_name:"Missili a Ricerca",powerup_homing_missiles_desc:"Raccoglie Missili a Ricerca nell'Inventario Ultra. Spara missili che cercano i nemici per 15 secondi. Attiva con il tasto 4 o 5.",powerup_shield_name:"Scudo",powerup_shield_desc:"Assorbe un colpo. Dura 15 secondi o finché non viene colpito.",powerup_repair_kit_name:"Kit di Riparazione",powerup_repair_kit_desc:"Ripristina completamente l'energia della nave.",powerup_extra_life_name:"Vita Extra",powerup_extra_life_desc:"Conferisce istantaneamente una vita extra, fino al massimo consentito.",powerup_ghost_protocol_name:"Protocollo Fantasma",powerup_ghost_protocol_desc:"Rende la nave invulnerabile e immune alle collisioni per un breve periodo.",powerup_orbital_drone_name:"Drone Orbitale",powerup_orbital_drone_desc:"Raccoglie un drone da combattimento autonomo. Fino a 3 droni sono attivi per 30s. Ogni nuovo drone resetta il timer per tutti.",powerup_nuke_name:"Bomba Nucleare",powerup_nuke_desc:"Distrugge istantaneamente tutti i nemici standard visibili. Attiva con il tasto 1, 2 o 3.",powerup_black_hole_name:"Buco Nero",powerup_black_hole_desc:"Crea un buco nero. Tieni premuto il tasto 1, 2 o 3 per mirare e rilascia per attivarlo. Attira i nemici (immune ai boss).",powerup_score_boost_name:"Moltiplicatore Punti",powerup_score_boost_desc:"Raddoppia tutti i punti raccolti per 20 secondi. Attiva con il tasto 1, 2 o 3.",gegner_header:"Unità Ostili",gegner_grunt_name:"Grunt",gegner_grunt_desc:"Fanteria standard. Vola in linea retta ed è la minaccia più basilare.",gegner_weaver_name:"Weaver",gegner_weaver_desc:"Si muove in onde sinusoidali imprevedibili ed è difficile da colpire.",gegner_tank_name:"Tank",gegner_tank_desc:"Lento ma pesantemente corazzato. Resiste a più colpi e infligge danni da collisione maggiori.",gegner_shooter_name:"Shooter",gegner_shooter_desc:"Spara regolarmente proiettili singoli verso il giocatore. Un bersaglio ad alta priorità.",gegner_sentinel_prime_name:"Sentinel Prime",gegner_sentinel_prime_desc:"Un'unità di pattuglia con attacchi variegati, inclusi ventagli, spirali e un pericoloso attacco in carica.",gegner_void_serpent_name:"Serpente del Vuoto",gegner_void_serpent_desc:"Un leviatano massiccio che si muove con un ampio andamento serpentino, sparando ampie raffiche e colpi mirati.",gegner_omega_nexus_name:"Omega Nexus",gegner_omega_nexus_desc:"Una macchina da guerra simile a una fortezza. I suoi schemi di attacco cambiano con i danni, culminando in un potente raggio laser.",gegner_nexus_prime_name:"Nexus Prime (Finale)",gegner_nexus_prime_desc:"La forma definitiva del Nexus. Dispone di un laser a spazzata, droni indistruttibili e una pioggia di proiettili implacabile.",strength_low:"Basso",strength_medium:"Medio",strength_high:"Alto",strength_extreme:"Estremo",strength_apocalyptic:"Apocalittico",strength_final:"FINALE",wave_msg_1:"Ondata 1: Invasione",wave_msg_2:"Ondata 2: Weaver Avvistati",wave_msg_3:"Ondata 3: Unità Pesanti",wave_msg_4:"Ondata 4: Rispondere al Fuoco!",wave_msg_5:"BOSS: SENTINEL PRIME",wave_msg_6:"Ondata 6: Grandine di Proiettili",wave_msg_7:"Ondata 7: Danzatori Corazzati",wave_msg_8:"Ondata 8: Assalto Combinato",wave_msg_9:"Ondata 9: Escalation",wave_msg_10:"BOSS: SERPENTE DEL VUOTO",wave_msg_11:"Ondata 11: Lo Sciame",wave_msg_12:"Ondata 12: Muro d'Acciaio",wave_msg_13:"Ondata 13: Imprevedibile",wave_msg_14:"Ondata 14: Guardia Scelta",wave_msg_15:"BOSS: OMEGA NEXUS",wave_msg_16:"Ondata 16: Ranghi Infiniti",wave_msg_17:"Ondata 17: Caos Puro",wave_msg_18:"Ondata 18: Offensiva Totale",wave_msg_19:"Ondata 19: Inferno",wave_msg_20:"BOSS FINALE: NEXUS PRIME",game_over_title:"FINE PARTITA",game_over_final_score:"Punteggio Finale",game_over_prompt:"",victory_title:"VITTORIA!",victory_final_score:"Punteggio Finale",victory_prompt:"Premi INVIO per tornare al Menu",intro_prompt:"Premi INVIO per Iniziare",intro_prompt_mobile:"Tocca per Iniziare",lang_select_title:"SELEZIONA LINGUA",w_tier:"L-Arma",off:"NO",low:"BASSO",high:"ALTO",on:"SÌ",buff_rf:"FR",buff_sideshots:"CL<>",buff_orbital:"O"},te={en:$,de:j,es:J,zh:Z,ja:Q,it:ee},se="/Galaxy-fall2/assets/player_tier1-BGuEVhdV.png",ie="/Galaxy-fall2/assets/player_tier2-BNKSb4SP.png",ae="/Galaxy-fall2/assets/player_tier3-CLvfjKA7.png",ne="/Galaxy-fall2/assets/player_tier4-B1afeGUG.png",re="/Galaxy-fall2/assets/enemy_grunt-CLkKISY_.png",oe="/Galaxy-fall2/assets/enemy_tank-DevmETt8.png",le="/Galaxy-fall2/assets/enemy_weaver-SPRiRDSK.png",he="/Galaxy-fall2/assets/enemy_shooter-CMoO9QtZ.png",ge="/Galaxy-fall2/assets/boss_sentinel_prime-Dy4-a5Z_.png",pe="/Galaxy-fall2/assets/boss_void_serpent-CEgzkHPT.png",ce="/Galaxy-fall2/assets/boss_omega_nexus_base-vNYxILcC.png",de="/Galaxy-fall2/assets/boss_omega_nexus_ring-D0w1CBIA.png",A="/Galaxy-fall2/assets/powerup_weapon_up-BVpNRrUf.png",I="/Galaxy-fall2/assets/powerup_rapid_fire-D-ryUnye.png",k="/Galaxy-fall2/assets/powerup_side_shots-BpLfr9MP.png",O="/Galaxy-fall2/assets/powerup_laser_beam-CU97HRws.png",P="/Galaxy-fall2/assets/powerup_homing_missiles-cGzXJkLq.png",R="/Galaxy-fall2/assets/powerup_shield-5awyPx3E.png",x="/Galaxy-fall2/assets/powerup_repair_kit-CHXnFl7N.png",L="/Galaxy-fall2/assets/powerup_extra_life-DYIf3ycm.png",C="/Galaxy-fall2/assets/powerup_ghost_protocol-CDsToGOK.png",B="/Galaxy-fall2/assets/powerup_orbital_drone-BiJqGdU1.png",N="/Galaxy-fall2/assets/powerup_nuke-BymPmf-e.png",H="/Galaxy-fall2/assets/powerup_black_hole-Bwd8kZWb.png",D="/Galaxy-fall2/assets/powerup_score_boost-C6cwsuh0.png",_e="/Galaxy-fall2/assets/orbital_drone_1-BmOkXB0E.png",me="/Galaxy-fall2/assets/orbital_drone_2-CJsKYhNq.png",ue="/Galaxy-fall2/assets/orbital_drone_3-B6uMGaBN.png",p=g=>{const e=new Image;return e.src=g,e},T=p(se),fe=p(ie),we=p(ae),ye=p(ne),ve=p(re),Ee=p(oe),Se=p(le),be=p(he),Te=p(ge),Me=p(pe),G=p(ce),U=p(de),Ae=[p(_e),p(me),p(ue)],Ie={WEAPON_UP:p(A),RAPID_FIRE:p(I),SIDE_SHOTS:p(k),LASER_BEAM:p(O),HOMING_MISSILES:p(P),SHIELD:p(R),REPAIR_KIT:p(x),EXTRA_LIFE:p(L),GHOST_PROTOCOL:p(C),ORBITAL_DRONE:p(B),NUKE:p(N),BLACK_HOLE:p(H),SCORE_BOOST:p(D)},M={WEAPON_UP:A,RAPID_FIRE:I,SIDE_SHOTS:k,LASER_BEAM:O,HOMING_MISSILES:P,SHIELD:R,REPAIR_KIT:x,EXTRA_LIFE:L,GHOST_PROTOCOL:C,ORBITAL_DRONE:B,NUKE:N,BLACK_HOLE:H,SCORE_BOOST:D};class u{constructor(e,t){this.x=e,this.y=t}}class E{constructor(e,t,s,i,a){this.family="none",this.type="NONE",this._isGarbage=!1,this.game=e,this.pos=new u(t,s),this.width=i,this.height=a}update(e){}draw(e){}isAlive(){return!this._isGarbage}destroy(){this._isGarbage=!0}}class y extends E{constructor(e,t,s,i,a,r,o){super(e,t,s,i,a),this.family=r,this.type=o}}class ke extends E{constructor(e,t,s,i,a=.5,r=2){super(e,t,s,0,0),this.family="effect",this.type="PARTICLE",this.vel=new u((Math.random()-.5)*50,(Math.random()-.5)*50),this.size=Math.random()*r+1,this.life=Math.random()*a,this.initialLife=this.life,this.color=i}update(e){const t=e/1e3;this.pos.x+=this.vel.x*t,this.pos.y+=this.vel.y*t,this.life-=t,this.life<=0&&this.destroy()}draw(e){e.save(),e.globalAlpha=this.life/this.initialLife,e.fillStyle=this.color,e.beginPath(),e.arc(this.pos.x,this.pos.y,this.size,0,Math.PI*2),e.fill(),e.restore()}}class F extends y{constructor(e,t,s,i="#FFA500",a=1){super(e,t,s,0,0,"effect","EXPLOSION"),this.particles=[];const r=(this.game.uiManager.settings.particles===2?20:this.game.uiManager.settings.particles===1?10:0)*a;for(let o=0;o<r;o++)this.particles.push({pos:new u(t,s),vel:new u(Math.random()*360-180,Math.random()*360-180),size:Math.random()*4+1,life:.7,color:i})}update(e){const t=e/1e3;this.particles.forEach(s=>{s.pos.x+=s.vel.x*t,s.pos.y+=s.vel.y*t,s.life-=t}),this.particles=this.particles.filter(s=>s.life>0),this.particles.length===0&&this.destroy()}draw(e){this.particles.forEach(t=>{e.save(),e.globalAlpha=t.life/.7,e.fillStyle=t.color,e.beginPath(),e.arc(t.pos.x,t.pos.y,t.size,0,Math.PI*2),e.fill(),e.restore()})}}class Oe extends E{constructor(e){super(e,e.width/2,e.height/2,0,0),this.radius=0,this.life=1,this.type="EFFECT"}update(e){const t=e/1e3;this.radius+=1200*t,this.life-=t,this.life<=0&&this.destroy()}draw(e){e.save(),e.fillStyle=`rgba(255,255,255,${this.life})`,e.beginPath(),e.arc(this.pos.x,this.pos.y,this.radius,0,Math.PI*2),e.fill(),e.restore()}}class Pe extends E{constructor(e,t,s,i="#F0F"){super(e,t,s,0,0),this.radius=0,this.life=.5,this.initialLife=.5,this.family="effect",this.type="SHOCKWAVE",this.color=i}update(e){const t=e/1e3;this.radius+=800*t,this.life-=t,this.life<=0&&this.destroy()}draw(e){e.save(),e.globalAlpha=this.life/this.initialLife,e.strokeStyle=this.color,e.lineWidth=5,e.beginPath(),e.arc(this.pos.x,this.pos.y,this.radius,0,Math.PI*2),e.stroke(),e.restore()}}class Re extends y{constructor(e,t,s,i){super(e,t,s,15,15,"pickup","COIN"),this.speed=180,this.value=i}update(e){this.pos.y+=this.speed*(e/1e3),this.pos.y>this.game.height&&this.destroy()}draw(e){e.save(),e.fillStyle="#FFDC00",e.beginPath(),e.arc(this.pos.x+this.width/2,this.pos.y+this.height/2,this.width/2,0,Math.PI*2),e.fill(),e.fillStyle="#F39C12",e.textAlign="center",e.textBaseline="middle",e.font="10px 'Press Start 2P'",e.fillText("$",this.pos.x+this.width/2,this.pos.y+this.height/2+1),e.restore()}onCollect(){if(this.game.player){const e=this.game.player.isScoreBoosted()?this.value*2:this.value;this.game.score+=e,this.game.scoreEarnedThisLevel+=e}this.destroy()}}class xe extends y{constructor(e,t,s){super(e,t,s,38,38,"pickup","POWERUP"),this.speed=150;const i=["WEAPON_UP","SIDE_SHOTS","RAPID_FIRE","SHIELD","REPAIR_KIT","EXTRA_LIFE","GHOST_PROTOCOL","ORBITAL_DRONE","NUKE","BLACK_HOLE","SCORE_BOOST","LASER_BEAM","HOMING_MISSILES"];this.powerUpType=i[Math.floor(Math.random()*i.length)]}update(e){this.pos.y+=this.speed*(e/1e3),this.pos.y>this.game.height&&this.destroy()}draw(e){const t=Ie[this.powerUpType];t&&e.drawImage(t,this.pos.x,this.pos.y,this.width,this.height)}onCollect(){if(this.game.player){const e=["NUKE","BLACK_HOLE","SCORE_BOOST"],t=["LASER_BEAM","HOMING_MISSILES"];e.includes(this.powerUpType)?this.game.player.powerUpManager.collectSpecial(this.powerUpType):t.includes(this.powerUpType)?this.game.player.powerUpManager.collectUltra(this.powerUpType):this.game.player.powerUpManager.activate(this.powerUpType)}this.destroy()}}class _ extends y{constructor(e,t,s,i,a,r,o,h){super(e,t,s,i,a,"enemy",h),this.stunTimer=0,this.speed=90,this.isBoss=!1,this.collisionDamage=35,this.baseHealth=r,this.health=this.baseHealth*e.enemyHealthMultiplier,this.maxHealth=this.health,this.pointsValue=o}takeHit(e){if(this.isAlive()&&(this.health-=e,this.health<=0)){this.destroy();let t=this.pointsValue*this.game.level;this.game.player&&this.game.player.isScoreBoosted()&&(t*=2),this.game.score+=t,this.game.scoreEarnedThisLevel+=t,this.isBoss&&(this.game.isBossActive=!1,this.game.changeState("LEVEL_START")),this.game.uiManager.settings.particles>0&&this.game.addEntity(new F(this.game,this.pos.x+this.width/2,this.pos.y+this.height/2)),Math.random()<.2&&this.game.addEntity(new Re(this.game,this.pos.x,this.pos.y,this.pointsValue)),Math.random()<.15&&this.game.addEntity(new xe(this.game,this.pos.x,this.pos.y)),this.game.uiManager.soundManager.play("enemyExplosion")}}update(e){if(this.stunTimer>0){this.stunTimer-=e;return}const t=e/1e3;this.pos.y+=this.speed*t,this.pos.y>this.game.height&&this.destroy()}stun(e){this.stunTimer=e}drawHealthBar(e){this.health<this.maxHealth&&!this.isBoss&&(e.save(),e.fillStyle="#500",e.fillRect(this.pos.x,this.pos.y-10,this.width,5),e.fillStyle="#f00",e.fillRect(this.pos.x,this.pos.y-10,this.width*(this.health/this.maxHealth),5),e.restore())}}class b extends _{constructor(e){super(e,Math.random()*(e.width-60),-54,60,54,1,10,"GRUNT"),this.speed=100*e.enemySpeedMultiplier,this.collisionDamage=35,this.image=ve}draw(e){e.save(),e.drawImage(this.image,this.pos.x,this.pos.y,this.width,this.height),this.drawHealthBar(e),e.restore()}}class v extends _{constructor(e){super(e,Math.random()*(e.width-100),-96,100,96,3,30,"TANK"),this.speed=60*e.enemySpeedMultiplier,this.collisionDamage=50,this.image=Ee}draw(e){e.save(),e.drawImage(this.image,this.pos.x,this.pos.y,this.width,this.height),this.drawHealthBar(e),e.restore()}}class S extends _{constructor(e){super(e,Math.random()*(e.width-55),-46,55,46,1,20,"WEAVER"),this.speed=80*e.enemySpeedMultiplier,this.angle=Math.random()*Math.PI*2,this.hSpeed=(Math.random()*2+1)*60,this.collisionDamage=35,this.image=Se}update(e){const t=e/1e3;super.update(e),this.angle+=3*t,this.pos.x+=Math.sin(this.angle)*this.hSpeed*t,(this.pos.x<0||this.pos.x>this.game.width-this.width)&&(this.pos.x=Math.max(0,Math.min(this.pos.x,this.game.width-this.width)),this.hSpeed*=-1)}draw(e){e.save(),e.drawImage(this.image,this.pos.x,this.pos.y,this.width,this.height),this.drawHealthBar(e),e.restore()}}class w extends _{constructor(e){super(e,Math.random()*(e.width-52),-52,52,52,2,50,"SHOOTER"),this.speed=70*e.enemySpeedMultiplier,this.fireCooldown=Math.random()*1e3+1500,this.collisionDamage=50,this.image=be}update(e){super.update(e),this.fireCooldown-=e,this.fireCooldown<=0&&this.pos.y>0&&(this.game.addEntity(new m(this.game,this.pos.x+this.width/2,this.pos.y+this.height)),this.fireCooldown=2e3)}draw(e){e.save(),e.drawImage(this.image,this.pos.x,this.pos.y,this.width,this.height),this.drawHealthBar(e),e.restore()}}class Le extends E{constructor(e,t,s){super(e,t,s,0,0),this.life=8e3,this.pullRadius=300,this.killRadius=20,this.type="EFFECT"}update(e){const t=e/1e3;if(this.life-=e,this.life<=0){this.game.entities.forEach(s=>{Math.hypot(this.pos.x-(s.pos.x+s.width/2),this.pos.y-(s.pos.y+s.height/2))<this.pullRadius&&s instanceof _&&!s.isBoss&&s.takeHit(9999)}),this.destroy(),this.game.addEntity(new Pe(this.game,this.pos.x,this.pos.y,"#EE82EE"));return}this.game.entities.forEach(s=>{if(s.family==="enemy"||s.family==="pickup"){const i=Math.hypot(this.pos.x-(s.pos.x+s.width/2),this.pos.y-(s.pos.y+s.height/2));if(i<this.pullRadius){s instanceof _&&!s.isBoss&&s.stun(50);const a=Math.atan2(this.pos.y-s.pos.y,this.pos.x-s.pos.x),r=180*(1-i/this.pullRadius);s.pos.x+=Math.cos(a)*r*t,s.pos.y+=Math.sin(a)*r*t,i<this.killRadius&&(s instanceof _&&!s.isBoss?s.takeHit(9999):s instanceof _||s.destroy())}}})}draw(e){e.save(),e.fillStyle="black",e.beginPath(),e.arc(this.pos.x,this.pos.y,this.killRadius,0,Math.PI*2),e.fill(),e.strokeStyle="#f0f",e.lineWidth=3,e.beginPath(),e.arc(this.pos.x,this.pos.y,this.pullRadius*(this.life/8e3),0,Math.PI*2),e.stroke(),e.restore()}}class c extends y{constructor(e,t,s,i=0,a=-600){super(e,t-2.5,s,5,20,"projectile","PROJECTILE"),this.damage=1,this.vel=new u(i,a)}update(e){const t=e/1e3;this.pos.x+=this.vel.x*t,this.pos.y+=this.vel.y*t,(this.pos.y<-this.height||this.pos.y>this.game.height||this.pos.x<-this.width||this.pos.x>this.game.width)&&this.destroy()}draw(e){e.save(),e.fillStyle="#0ff",e.shadowColor="#0ff",e.shadowBlur=5,e.fillRect(this.pos.x,this.pos.y,this.width,this.height),e.restore()}onHit(e){this.destroy()}}class Ce extends c{constructor(e,t,s,i=0,a=-600){super(e,t,s,i,a),this.pos.x=t-4,this.width=8,this.height=22,this.damage=2.5}draw(e){e.save(),e.fillStyle="#FFD700",e.shadowColor="#FFA500",e.shadowBlur=8,e.fillRect(this.pos.x,this.pos.y,this.width,this.height),e.restore()}}class W extends c{constructor(e,t,s,i=0,a=-700){super(e,t,s,i,a),this.hitEnemies=[],this.pos.x=t-3,this.width=6,this.height=25,this.damage=.8}draw(e){e.save(),e.fillStyle="#9400D3",e.shadowColor="#EE82EE",e.shadowBlur=10,e.fillRect(this.pos.x,this.pos.y,this.width,this.height),e.restore()}onHit(e){this.hitEnemies.push(e)}hasHit(e){return this.hitEnemies.includes(e)}}class K extends c{constructor(e,t,s,i,a){super(e,t-10,s-10,i,a),this.width=20,this.height=20,this.type="BLACK_HOLE_PROJECTILE"}draw(e){e.save(),e.fillStyle="#9400D3",e.shadowColor="#EE82EE",e.shadowBlur=15,e.beginPath(),e.arc(this.pos.x+this.width/2,this.pos.y+this.height/2,this.width/2,0,Math.PI*2),e.fill(),e.restore()}onHit(e){this.game.addEntity(new Le(this.game,this.pos.x+this.width/2,this.pos.y+this.height/2)),this.destroy()}}class Be extends y{constructor(e,t){super(e,0,0,60,e.height,"projectile","LASER_BEAM"),this.damage=.2,this.soundCooldown=0,this.phase=0,this.amplitude=30,this.frequency=.02,this.player=t}update(e){if(!this.player.isAlive()||!this.player.powerUpManager.isActive("LASER_BEAM")){this.destroy();return}this.pos.x=this.player.pos.x+this.player.width/2-this.amplitude,this.pos.y=0,this.height=this.player.pos.y,this.phase+=e/1e3*15,this.soundCooldown-=e,this.soundCooldown<=0&&(this.game.uiManager.soundManager.play("laser"),this.soundCooldown=100)}draw(e){e.save();const t=this.player.pos.x+this.player.width/2,s=this.player.pos.y;e.beginPath(),e.moveTo(t+Math.sin(this.phase)*this.amplitude,s);for(let i=s;i>0;i--){const a=Math.sin(i*this.frequency+this.phase)*this.amplitude;e.lineTo(t+a,i)}e.strokeStyle="#f0f",e.lineWidth=15,e.shadowColor="#f0f",e.shadowBlur=20,e.stroke(),e.beginPath(),e.moveTo(t+Math.sin(this.phase)*this.amplitude,s);for(let i=s;i>0;i--){const a=Math.sin(i*this.frequency+this.phase)*this.amplitude;e.lineTo(t+a,i)}e.strokeStyle="#EE82EE",e.lineWidth=8,e.shadowColor="#EE82EE",e.shadowBlur=15,e.stroke(),e.beginPath(),e.moveTo(t+Math.sin(this.phase)*this.amplitude,s);for(let i=s;i>0;i--){const a=Math.sin(i*this.frequency+this.phase)*this.amplitude;e.lineTo(t+a,i)}e.strokeStyle="white",e.lineWidth=2,e.stroke(),e.restore()}}class Ne extends c{constructor(e,t,s){super(e,t,s,(Math.random()-.5)*200,-300),this.target=null,this.searchCooldown=0,this.lifetime=5e3,this.type="HOMING_MISSILE",this.damage=15,this.width=8,this.height=16}findTarget(){const e=this.game.entities.filter(i=>i.family==="enemy"&&i.isAlive());if(e.length===0){this.target=null;return}let t=null,s=1/0;e.forEach(i=>{const a=Math.hypot(this.pos.x-(i.pos.x+i.width/2),this.pos.y-(i.pos.y+i.height/2));a<s&&(s=a,t=i)}),this.target=t}update(e){if(this.lifetime-=e,this.searchCooldown-=e,this.searchCooldown<=0&&(this.findTarget(),this.searchCooldown=500),this.target&&this.target.isAlive()){const i=e/1e3,a=this.target.pos.x+this.target.width/2,r=this.target.pos.y+this.target.height/2,o=a-this.pos.x,h=r-this.pos.y,l=Math.hypot(o,h),n=l>0?o/l*400:0,d=l>0?h/l*400:0;this.vel.x+=(n-this.vel.x)*5*i,this.vel.y+=(d-this.vel.y)*5*i}super.update(e),this.lifetime<=0&&this.destroy()}draw(e){e.save(),e.translate(this.pos.x+this.width/2,this.pos.y+this.height/2);const t=Math.atan2(this.vel.y,this.vel.x)+Math.PI/2;e.rotate(t),e.fillStyle="#ff9900",e.shadowColor="#ff5722",e.shadowBlur=10,e.beginPath(),e.moveTo(0,-this.height/2),e.lineTo(-this.width/2,this.height/2),e.lineTo(this.width/2,this.height/2),e.closePath(),e.fill();const s=Math.random()*8+4;e.fillStyle="#ff5722",e.beginPath(),e.moveTo(0,this.height/2),e.lineTo(-this.width/2+2,this.height/2+s/2),e.lineTo(0,this.height/2+s),e.lineTo(this.width/2-2,this.height/2+s/2),e.closePath(),e.fill(),e.restore()}}class m extends c{constructor(e,t,s,i=0,a=360,r=25){super(e,t,s,i,a),this.type="ENEMY_PROJECTILE",this.width=5,this.height=10,this.playerDamage=r}draw(e){e.save(),e.fillStyle="#FF4136",e.shadowColor="#FF4136",e.shadowBlur=5,e.fillRect(this.pos.x,this.pos.y,this.width,this.height),e.restore()}}class He extends y{constructor(e,t,s){super(e,0,0,36,36,"player","DRONE"),this.orbitRadius=75,this.fireCooldown=0,this.tier=t,this.index=s,this.image=Ae[this.tier-1]}updateIndex(e){this.index=e}update(e){if(!this.game.player||!this.game.player.isAlive()||!this.game.player.powerUpManager.isActive("ORBITAL_DRONE")){this.destroy();return}const t=this.game.player.drones.length,s=2*Math.PI/t*this.index,i=this.game.player.droneAngle+s,a=this.game.player.pos;this.pos.x=a.x+this.game.player.width/2+Math.cos(i)*this.orbitRadius,this.pos.y=a.y+this.game.player.height/2+Math.sin(i)*this.orbitRadius,this.fireCooldown-=e,this.fireCooldown<=0&&this.shoot()}shoot(){switch(this.tier){case 1:this.game.addEntity(new c(this.game,this.pos.x,this.pos.y)),this.fireCooldown=600;break;case 2:this.game.addEntity(new Ce(this.game,this.pos.x,this.pos.y)),this.fireCooldown=500;break;case 3:this.game.addEntity(new W(this.game,this.pos.x,this.pos.y)),this.fireCooldown=400;break}}draw(e){e.save(),e.drawImage(this.image,this.pos.x-this.width/2,this.pos.y-this.height/2,this.width,this.height),e.restore()}}class De{constructor(e){this.weaponTier=1,this.weaponTierTimer=0,this.ultraWeapon=null,this.timers={},this.specialInventory=[],this.ultraInventory=[],this.player=e,this.game=e.game}update(e){for(const t in this.timers)this.timers[t]-=e,this.timers[t]<=0&&this.deactivate(t);this.weaponTierTimer>0&&(this.weaponTierTimer-=e,this.weaponTierTimer<=0&&(this.weaponTier--,this.setWeaponTierTimer()))}setWeaponTierTimer(){if(this.weaponTier<=1){this.weaponTier=1,this.weaponTierTimer=0;return}switch(this.weaponTier){case 4:this.weaponTierTimer=3e4;break;case 3:this.weaponTierTimer=6e4;break;case 2:this.weaponTierTimer=9e4;break}}deactivate(e){delete this.timers[e],this.ultraWeapon===e?(this.ultraWeapon=null,this.player.laser&&(this.player.laser.destroy(),this.player.laser=null)):e==="ORBITAL_DRONE"&&(this.player.drones.forEach(t=>t.destroy()),this.player.drones=[])}resetTemporaryPowerUps(){Object.keys(this.timers).forEach(e=>this.deactivate(e)),this.ultraWeapon=null}isActive(e){return this.timers[e]>0}onPlayerHit(){this.weaponTier>1&&(this.weaponTier--,this.setWeaponTierTimer())}collectSpecial(e){this.collectToInventory(e,this.specialInventory,3)}collectUltra(e){this.collectToInventory(e,this.ultraInventory,2)}collectToInventory(e,t,s){const i=t.find(a=>a.type===e);i?i.count++:t.length<s&&t.push({type:e,count:1}),this.game.uiManager.soundManager.play("powerup")}activateSpecial(e){const t=this.specialInventory[e];if(t){if(t.type==="BLACK_HOLE"){const s=this.game.player;this.game.addEntity(new K(this.game,s.pos.x+s.width/2,s.pos.y,0,-600)),this.game.uiManager.soundManager.play("missileLaunch")}else this.activate(t.type);t.count--,t.count<=0&&this.specialInventory.splice(e,1)}}activateUltra(e){const t=this.ultraInventory[e];t&&(this.ultraWeapon&&this.deactivate(this.ultraWeapon),this.activate(t.type),t.count--,t.count<=0&&this.ultraInventory.splice(e,1))}activate(e,t){const s={LASER_BEAM:1e4,HOMING_MISSILES:15e3},i={SIDE_SHOTS:15e3,RAPID_FIRE:3e4},a=["SHIELD","REPAIR_KIT","EXTRA_LIFE","GHOST_PROTOCOL"],r=["NUKE","SCORE_BOOST"];if(e==="ORBITAL_DRONE"){if(this.player.drones.length<3){const o=this.player.drones.length+1;this.player.drones.push(new He(this.game,o,this.player.drones.length)),this.player.drones.forEach((h,l)=>h.updateIndex(l))}this.timers.ORBITAL_DRONE=3e4}else e==="WEAPON_UP"?(this.weaponTier<4&&this.weaponTier++,this.setWeaponTierTimer()):Object.keys(i).includes(e)?this.timers[e]=t??i[e]:Object.keys(s).includes(e)?(this.ultraWeapon=e,this.timers[e]=t??s[e]):a.includes(e)?e==="EXTRA_LIFE"?this.player.lives<this.player.maxLives&&this.player.lives++:e==="REPAIR_KIT"?this.player.energy=100:this.timers[e]=t??15e3:r.includes(e)&&(e==="NUKE"?(this.game.entities.filter(o=>o.family==="enemy"&&!o.isBoss).forEach(o=>o.takeHit(9999)),this.game.addEntity(new Oe(this.game))):e==="SCORE_BOOST"&&(this.timers[e]=2e4));this.game.uiManager.soundManager.play("powerup")}shoot(){const e=this.player;if(e.fireCooldown=this.isActive("RAPID_FIRE")?75:150,this.ultraWeapon)switch(this.ultraWeapon){case"LASER_BEAM":(!e.laser||!e.laser.isAlive())&&(e.laser=new Be(this.game,e),this.game.addEntity(e.laser)),e.fireCooldown=0;break;case"HOMING_MISSILES":this.game.addEntity(new Ne(this.game,e.pos.x+e.width/2,e.pos.y)),e.fireCooldown=400,this.game.uiManager.soundManager.play("missileLaunch");break}const t=e.pos.x,s=e.pos.y,i=e.width,a=e.height,r=-600,o=15*(Math.PI/180);switch(this.weaponTier){case 1:this.game.addEntity(new c(this.game,t+i/2,s));break;case 2:this.game.addEntity(new c(this.game,t+i*.2,s)),this.game.addEntity(new c(this.game,t+i*.8,s));break;case 3:this.game.addEntity(new c(this.game,t+i/2,s,0,r)),this.game.addEntity(new c(this.game,t+i/2,s,Math.sin(-o)*Math.abs(r),Math.cos(-o)*r)),this.game.addEntity(new c(this.game,t+i/2,s,Math.sin(o)*Math.abs(r),Math.cos(o)*r));break;case 4:this.game.addEntity(new c(this.game,t+i*.1,s,-150,r)),this.game.addEntity(new c(this.game,t+i*.9,s,150,r)),this.game.addEntity(new c(this.game,t+i*.3,s)),this.game.addEntity(new c(this.game,t+i*.7,s));break}this.isActive("SIDE_SHOTS")&&(this.game.addEntity(new c(this.game,t,s+a/2,-300,0)),this.game.addEntity(new c(this.game,t+i,s+a/2,300,0))),this.game.uiManager.soundManager.play("shoot")}}class Ge extends y{constructor(e){super(e,e.width/2-25,e.height-80,50,40,"player","PLAYER"),this.speed=400,this.lives=3,this.maxLives=5,this.energy=100,this.fireCooldown=0,this.drones=[],this.laser=null,this.droneAngle=0,this.isChargingBlackHole=!1,this.blackHoleChargeSlot=null,this.powerUpManager=new De(this)}update(e){const t=e/1e3;if(this.game.isMobile){if(this.game.touchX!==null&&this.game.touchY!==null){const s=this.game.touchX-this.width/2,i=this.game.touchY-this.height/2;this.pos.x+=(s-this.pos.x)*.2,this.pos.y+=(i-this.pos.y)*.2}}else{const s=new u(0,0);(this.game.keys.ArrowLeft||this.game.keys.KeyA)&&(s.x=-1),(this.game.keys.ArrowRight||this.game.keys.KeyD)&&(s.x=1),(this.game.keys.ArrowUp||this.game.keys.KeyW)&&(s.y=-1),(this.game.keys.ArrowDown||this.game.keys.KeyS)&&(s.y=1);const i=Math.hypot(s.x,s.y);i>0&&(this.pos.x+=s.x/i*this.speed*t,this.pos.y+=s.y/i*this.speed*t)}this.pos.x=Math.max(0,Math.min(this.pos.x,this.game.width-this.width)),this.pos.y=Math.max(0,Math.min(this.pos.y,this.game.height-this.height)),this.fireCooldown<=0&&!this.isChargingBlackHole&&this.shoot(),this.fireCooldown>0&&(this.fireCooldown-=e),this.droneAngle+=3*t,this.powerUpManager.update(e),this.drones.forEach(s=>s.update(e))}draw(e){e.save(),e.globalAlpha=this.isGhosted()?.5:1;const t=this.powerUpManager.weaponTier;let s;switch(t){case 1:s=T;break;case 2:s=fe;break;case 3:s=we;break;case 4:s=ye;break;default:s=T}const i=this.pos.x+this.width/2-s.width/2,a=this.pos.y+this.height/2-s.height/2;if(e.drawImage(s,i,a),this.drones.forEach(r=>r.draw(e)),this.isShielded()){const r=this.powerUpManager.timers.SHIELD<1e3&&Math.floor(Date.now()/100)%2===0?0:.4;e.fillStyle=`rgba(11,255,255,${r})`,e.beginPath(),e.arc(this.pos.x+this.width/2,this.pos.y+this.height/2,this.width*.7,0,Math.PI*2),e.fill()}e.restore()}shoot(){this.powerUpManager.shoot()}takeHit(e){if(!this.isGhosted()){if(this.isShielded()){this.powerUpManager.deactivate("SHIELD"),this.game.uiManager.soundManager.play("shieldDown");return}this.powerUpManager.onPlayerHit(),this.energy-=e,this.game.uiManager.soundManager.play("playerHit"),this.energy<=0&&(this.lives--,this.lives<=0?(this.destroy(),this.game.addEntity(new F(this.game,this.pos.x+this.width/2,this.pos.y+this.height/2,"#FFFFFF",2)),this.game.uiManager.soundManager.play("playerExplosion")):(this.energy=100,this.pos.x=this.game.width/2-this.width/2,this.pos.y=this.game.height-80,this.powerUpManager.activate("GHOST_PROTOCOL",5e3)))}}isShielded(){return this.powerUpManager.isActive("SHIELD")}isGhosted(){return this.powerUpManager.isActive("GHOST_PROTOCOL")}isScoreBoosted(){return this.powerUpManager.isActive("SCORE_BOOST")}}class z extends _{constructor(e,t,s){super(e,e.width/2-225,-300,450,300,t,5e3,"BOSS_SENTINEL_PRIME"),this.attackPattern=0,this.attackTimer=4e3,this.summonTimer=8e3,this.movementPattern="ENTER",this.patrolY=50,this.isCharging=!1,this.chargeTargetX=0,this.chargeSpeed=600,this.isBoss=!0,this.hSpeed=100*s,this.image=Te,this.collisionDamage=75}update(e){const t=e/1e3;if(this.isCharging?(this.pos.x+=this.hSpeed*t,(this.hSpeed>0&&this.pos.x>=this.chargeTargetX||this.hSpeed<0&&this.pos.x<=this.chargeTargetX)&&(this.isCharging=!1,this.hSpeed=Math.abs(this.hSpeed)*(Math.random()>.5?1:-1))):this.movementPattern==="ENTER"?(this.pos.y+=100*t,this.pos.y>=this.patrolY&&(this.pos.y=this.patrolY,this.movementPattern="PATROL")):this.movementPattern==="PATROL"&&(this.pos.x+=this.hSpeed*t,(this.pos.x<=0||this.pos.x>=this.game.width-this.width)&&(this.pos.x=Math.max(0,Math.min(this.pos.x,this.game.width-this.width)),this.hSpeed*=-1)),this.attackTimer-=e,this.attackTimer<=0&&this.movementPattern==="PATROL"&&!this.isCharging){this.attackPattern=Math.floor(Math.random()*3),this.attackTimer=Math.max(2500,4e3-this.game.level*100);const s=this.pos.x,i=this.pos.y,a=this.width,r=this.height;switch(this.attackPattern){case 0:for(let o=0;o<10;o++)this.game.addEntity(new m(this.game,s+o*a/9,i+r,0,360,this.collisionDamage));break;case 1:for(let o=0;o<12;o++){const h=o*Math.PI/6;this.game.addEntity(new m(this.game,s+a/2,i+r/2,Math.cos(h)*240,Math.sin(h)*240,this.collisionDamage))}break;case 2:this.game.player&&(this.isCharging=!0,this.chargeTargetX=this.game.player.pos.x,this.hSpeed=this.chargeTargetX>this.pos.x?this.chargeSpeed:-this.chargeSpeed);break}}if(this.summonTimer-=e,this.summonTimer<=0&&this.movementPattern==="PATROL"){this.summonTimer=1e4-this.game.level*150;const s=2+Math.floor(this.game.level/5);for(let i=0;i<s;i++)setTimeout(()=>this.game.addEntity(new b(this.game)),i*400)}}draw(e){e.save(),this.isCharging&&(e.shadowColor="#FF4136",e.shadowBlur=20),e.drawImage(this.image,this.pos.x,this.pos.y,this.width,this.height),e.restore()}}class V extends _{constructor(e,t,s){super(e,e.width/2-225,-300,450,300,t,7500,"BOSS_VOID_SERPENT"),this.attackTimer=4e3,this.summonTimer=12e3,this.angle=0,this.verticalTargetY=80,this.waveSpeed=1.2,this.isBoss=!0,this.image=Me,this.collisionDamage=90,this.speed=40*s,this.waveAmplitude=this.game.width/2-this.width/2-20}update(e){const t=e/1e3;if(this.pos.y<this.verticalTargetY?this.pos.y+=this.speed*t:(this.angle+=this.waveSpeed*t,this.pos.x=this.game.width/2-this.width/2+Math.sin(this.angle)*this.waveAmplitude,this.verticalTargetY=80+Math.cos(this.angle*.5)*40,this.pos.y+=(this.verticalTargetY-this.pos.y)*.1),this.attackTimer-=e,this.attackTimer<=0&&this.pos.y>=60){this.attackTimer=Math.max(2e3,3500-this.game.level*100);const s=this.pos.x,i=this.pos.y,a=this.width,r=this.height;if((Math.random()>.4?"SPREAD":"WHIP")==="SPREAD")for(let h=-3;h<=3;h++){const l=h*.25;this.game.addEntity(new m(this.game,s+a/2,i+r*.8,Math.sin(l)*350,Math.cos(l)*350,this.collisionDamage))}else if(this.game.player){const h=this.game.player;for(let l=0;l<3;l++)setTimeout(()=>{const n=h.pos.x+h.width/2,d=h.pos.y+h.height/2,f=Math.atan2(d-(this.pos.y+r),n-(this.pos.x+a/2));this.game.addEntity(new m(this.game,s+a/2,i+r,Math.cos(f)*600,Math.sin(f)*600,this.collisionDamage))},l*150)}}if(this.summonTimer-=e,this.summonTimer<=0&&this.pos.y>=60){this.summonTimer=14e3-this.game.level*200;const s=3+Math.floor(this.game.level/6);for(let i=0;i<s;i++)setTimeout(()=>this.game.addEntity(new S(this.game)),i*500)}}draw(e){e.save(),e.drawImage(this.image,this.pos.x,this.pos.y,this.width,this.height),e.restore()}}class X extends _{constructor(e,t,s){super(e,e.width/2-225,-300,450,300,t,1e4,"BOSS_OMEGA_NEXUS"),this.ringAngle=0,this.ringRotationSpeed=.3,this.phase=1,this.attackTimer=5e3,this.summonTimer=1e4,this.isChargingLaser=!1,this.laserChargeTimer=3e3,this.laserActive=!1,this.laserDurationTimer=4e3,this.bulletHellTimer=200,this.bulletHellAngle=0,this.isBoss=!0,this.baseImage=G,this.ringImage=U,this.collisionDamage=120}takeHit(e){if(super.takeHit(e),!this.isAlive())return;const t=this.health/this.maxHealth;this.phase===1&&t<=.7?(this.phase=2,this.attackTimer=1e3):this.phase===2&&t<=.35&&(this.phase=3)}update(e){const t=e/1e3;switch(this.ringAngle+=this.ringRotationSpeed*t,this.pos.y<30&&(this.pos.y+=25*t),this.attackTimer-=e,this.summonTimer-=e,this.phase){case 1:this.updatePhase1(e);break;case 2:this.updatePhase2(e);break;case 3:this.updatePhase3(e);break}this.summonTimer<=0&&this.summonMinions()}updatePhase1(e){this.attackTimer<=0&&(this.attackTimer=4e3,this.fireTargetedBarrage(3,400))}updatePhase2(e){if(this.isChargingLaser){this.laserChargeTimer-=e,this.laserChargeTimer<=0&&(this.isChargingLaser=!1,this.laserActive=!0,this.laserDurationTimer=4e3);return}if(this.laserActive){this.laserDurationTimer-=e,this.laserDurationTimer<=0&&(this.laserActive=!1);return}this.attackTimer<=0&&(this.attackTimer=8e3,this.isChargingLaser=!0,this.laserChargeTimer=3e3)}updatePhase3(e){if(this.updatePhase2(e),this.bulletHellTimer-=e,this.bulletHellTimer<=0&&!this.laserActive){this.bulletHellTimer=100;const t=250;this.game.addEntity(new m(this.game,this.pos.x+this.width/2,this.pos.y+this.height/2,Math.cos(this.bulletHellAngle)*t,Math.sin(this.bulletHellAngle)*t,40)),this.game.addEntity(new m(this.game,this.pos.x+this.width/2,this.pos.y+this.height/2,Math.cos(this.bulletHellAngle+Math.PI)*t,Math.sin(this.bulletHellAngle+Math.PI)*t,40)),this.bulletHellAngle+=.3}}fireTargetedBarrage(e,t){if(!this.game.player)return;const s=this.game.player,i=this.pos.x+this.width/2,a=this.pos.y+this.height/2;for(let r=0;r<e;r++)setTimeout(()=>{const o=s.pos.x+s.width/2,h=s.pos.y+s.height/2,l=Math.atan2(h-a,o-i);this.game.addEntity(new m(this.game,i,a,Math.cos(l)*t,Math.sin(l)*t,this.collisionDamage))},r*200)}summonMinions(){switch(this.phase){case 1:this.summonTimer=12e3,this.game.addEntity(new b(this.game)),setTimeout(()=>this.game.addEntity(new v(this.game)),500);break;case 2:this.summonTimer=1e4,this.game.addEntity(new v(this.game)),setTimeout(()=>this.game.addEntity(new S(this.game)),500),setTimeout(()=>this.game.addEntity(new v(this.game)),1e3);break;case 3:this.summonTimer=8e3,this.game.addEntity(new w(this.game)),setTimeout(()=>this.game.addEntity(new v(this.game)),500),setTimeout(()=>this.game.addEntity(new w(this.game)),1e3);break}}draw(e){const t=this.pos.x+this.width/2,s=this.pos.y+this.height/2;if(e.drawImage(this.baseImage,this.pos.x,this.pos.y,this.width,this.height),e.save(),e.translate(t,s),e.rotate(this.ringAngle),e.drawImage(this.ringImage,-this.ringImage.width/2,-this.ringImage.height/2),e.restore(),this.isChargingLaser){const i=1-this.laserChargeTimer/3e3;e.fillStyle=`rgba(255, 100, 100, ${i*.7})`,e.beginPath(),e.arc(t,s+100,40*i,0,Math.PI*2),e.fill()}this.laserActive&&(e.fillStyle="rgba(255, 255, 255, 0.9)",e.fillRect(t-15,s,30,this.game.height),e.fillStyle="rgba(255, 100, 100, 0.7)",e.fillRect(t-25,s,50,this.game.height))}}class Y extends _{constructor(e,t,s){super(e,e.width/2-225,-300,450,300,t,25e3,"BOSS_NEXUS_PRIME"),this.ringAngle=0,this.ringRotationSpeed=.5,this.phase=1,this.attackTimer=4e3,this.summonTimer=9e3,this.isChargingLaser=!1,this.laserChargeTimer=2500,this.laserActive=!1,this.laserDurationTimer=3e3,this.laserSweepSpeed=80,this.bulletHellTimer=0,this.bulletHellAngle=0,this.drones=[],this.isBoss=!0,this.baseImage=G,this.ringImage=U,this.collisionDamage=150,this.laserX=this.game.width/2}takeHit(e){if(super.takeHit(e),!this.isAlive())return;const t=this.health/this.maxHealth;this.phase===1&&t<=.7?(this.phase=2,this.attackTimer=1e3,this.drones.push({pos:new u(100,150),angle:0}),this.drones.push({pos:new u(this.game.width-100,150),angle:Math.PI})):this.phase===2&&t<=.35&&(this.phase=3,this.ringRotationSpeed=1)}update(e){const t=e/1e3;switch(this.ringAngle+=this.ringRotationSpeed*t,this.pos.y<30&&(this.pos.y+=20*t),this.attackTimer-=e,this.summonTimer-=e,this.updateDrones(t),this.phase){case 1:this.updatePhase1(e);break;case 2:this.updatePhase2(e);break;case 3:this.updatePhase3(e);break}this.summonTimer<=0&&this.summonMinions()}updateDrones(e){this.drones.length!==0&&this.drones.forEach(t=>{if(t.angle+=3*e,this.game.player){const s=this.game.player,i=Math.atan2(s.pos.y-t.pos.y,s.pos.x-t.pos.x);Math.random()<.02&&this.game.addEntity(new m(this.game,t.pos.x,t.pos.y,Math.cos(i)*300,Math.sin(i)*300,30))}})}updatePhase1(e){this.attackTimer<=0&&(this.attackTimer=3500,this.fireTargetedBarrage(4,450))}updatePhase2(e){if(this.isChargingLaser){this.laserChargeTimer-=e,this.laserChargeTimer<=0&&(this.isChargingLaser=!1,this.laserActive=!0,this.laserDurationTimer=3e3,this.laserX=100,this.laserSweepSpeed=80);return}if(this.laserActive){this.laserDurationTimer-=e,this.laserX+=this.laserSweepSpeed*(e/1e3),(this.laserX>this.game.width-100||this.laserX<100)&&(this.laserSweepSpeed*=-1),this.laserDurationTimer<=0&&(this.laserActive=!1);return}this.attackTimer<=0&&(this.attackTimer=7e3,this.isChargingLaser=!0,this.laserChargeTimer=2500)}updatePhase3(e){if(this.updatePhase2(e),this.bulletHellTimer-=e,this.bulletHellTimer<=0){this.bulletHellTimer=80;const t=300;for(let s=0;s<4;s++){const i=this.bulletHellAngle+s*Math.PI/2;this.game.addEntity(new m(this.game,this.pos.x+this.width/2,this.pos.y+this.height/2,Math.cos(i)*t,Math.sin(i)*t,40))}this.bulletHellAngle+=.25}}fireTargetedBarrage(e,t){if(!this.game.player)return;const s=this.game.player,i=this.pos.x+this.width/2,a=this.pos.y+this.height/2;for(let r=0;r<e;r++)setTimeout(()=>{const o=s.pos.x+s.width/2,h=s.pos.y+s.height/2,l=Math.atan2(h-a,o-i);this.game.addEntity(new m(this.game,i,a,Math.cos(l)*t,Math.sin(l)*t,this.collisionDamage))},r*150)}summonMinions(){switch(this.phase){case 1:this.summonTimer=1e4,this.game.addEntity(new v(this.game)),setTimeout(()=>this.game.addEntity(new w(this.game)),500);break;case 2:this.summonTimer=9e3,this.game.addEntity(new w(this.game)),setTimeout(()=>this.game.addEntity(new S(this.game)),500),setTimeout(()=>this.game.addEntity(new w(this.game)),1e3);break;case 3:this.summonTimer=7e3;for(let e=0;e<3;e++)setTimeout(()=>this.game.addEntity(new w(this.game)),e*400);break}}draw(e){const t=this.pos.x+this.width/2,s=this.pos.y+this.height/2;if(e.save(),e.shadowColor="#FF4136",e.shadowBlur=this.phase*10,e.drawImage(this.baseImage,this.pos.x,this.pos.y,this.width,this.height),e.restore(),e.save(),e.translate(t,s),e.rotate(this.ringAngle),e.drawImage(this.ringImage,-this.ringImage.width/2,-this.ringImage.height/2),e.restore(),this.drones.forEach(i=>{e.fillStyle="#B10DC9",e.beginPath(),e.arc(i.pos.x,i.pos.y,20,0,Math.PI*2),e.fill(),e.fillStyle="#FF4136",e.beginPath(),e.arc(i.pos.x,i.pos.y,8,0,Math.PI*2),e.fill()}),this.isChargingLaser){const i=1-this.laserChargeTimer/2500;e.fillStyle=`rgba(255, 100, 100, ${i*.8})`,e.beginPath(),e.arc(t,s+100,45*i,0,Math.PI*2),e.fill()}this.laserActive&&(e.fillStyle="rgba(255, 255, 255, 0.9)",e.fillRect(this.laserX-10,0,20,this.game.height),e.fillStyle="rgba(255, 100, 100, 0.7)",e.fillRect(this.laserX-20,0,40,this.game.height))}}class Ue{constructor(e){this.audioCtx=null,this.masterGain=null,this.musicPlaying=!1,this.musicScheduler=null,this.currentStep=0,this.bpm=160,this.stepsPerBeat=4,this.totalSteps=64,this.scheduleAheadTime=.1,this.nextNoteTime=0,this.currentTrack="normal",this.leadMelody=[],this.bassLine=[],this.arpeggioMelody=[],this.kickPattern=[],this.snarePattern=[],this.hihatPattern=[],this.bossLeadMelody=[],this.bossBassLine=[],this.bossArpeggioMelody=[],this.bossKickPattern=[],this.bossSnarePattern=[],this.bossHihatPattern=[],this.uiManager=e,this.stepDuration=60/this.bpm/this.stepsPerBeat,this.defineMusicPatterns(),this.defineBossMusicPatterns()}initAudio(){if(!(this.audioCtx&&this.audioCtx.state==="running"))try{this.audioCtx||(this.audioCtx=new(window.AudioContext||window.webkitAudioContext),this.masterGain=this.audioCtx.createGain(),this.masterGain.connect(this.audioCtx.destination)),this.audioCtx.state==="suspended"&&this.audioCtx.resume(),this.setVolume(this.uiManager.settings.masterVolume),this.toggleMusic(this.uiManager.settings.music)}catch(e){console.error("Web Audio API is not supported or failed to initialize",e)}}defineMusicPatterns(){const e={C2:65.41,G2:98,Ab2:103.83,Eb2:77.78,Eb3:155.56,G3:196,Ab3:207.65,Bb3:233.08,C4:261.63,D4:293.66,Eb4:311.13,F4:349.23,G4:392,Ab4:415.3},t=0;this.leadMelody=[e.G4,t,e.Eb4,t,e.G4,t,e.F4,t,e.Eb4,t,e.D4,t,e.C4,t,t,t,e.G4,t,e.Eb4,t,e.G4,t,e.F4,t,e.G4,e.Ab4,e.G4,e.F4,e.Eb4,t,t,t,e.Ab4,t,e.F4,t,e.Ab4,t,e.G4,t,e.F4,t,e.Eb4,t,e.C4,t,e.Eb4,t,e.G4,e.F4,e.Eb4,t,e.D4,t,e.C4,t,e.C4,t,t,t,t,t,t,t],this.bassLine=[...Array(16).fill(e.C2),...Array(16).fill(e.G2),...Array(16).fill(e.Ab2),...Array(16).fill(e.Eb2)];const s=[e.C4,e.Eb4,e.G4,e.Eb4],i=[e.G3,e.Bb3,e.D4,e.Bb3],a=[e.Ab3,e.C4,e.Eb4,e.C4],r=[e.Eb3,e.G3,e.Bb3,e.G3];this.arpeggioMelody=[...s,...s,...s,...s,...i,...i,...i,...i,...a,...a,...a,...a,...r,...r,...r,...r];const o=!0,h=!0,l=!0,n=!1;this.kickPattern=[o,n,n,n,o,n,n,n,o,n,n,n,o,n,n,n,o,n,n,n,o,n,n,n,o,n,n,n,o,n,n,n,o,n,n,n,o,n,n,n,o,n,n,n,o,n,n,n,o,n,n,n,o,n,n,n,o,n,o,n,o,n,n,n],this.snarePattern=[n,n,n,n,h,n,n,n,n,n,n,n,h,n,n,n,n,n,n,n,h,n,n,n,n,n,n,n,h,n,n,n,n,n,n,n,h,n,n,n,n,n,n,n,h,n,n,n,n,n,n,n,h,n,n,n,n,n,h,n,h,n,h,n],this.hihatPattern=[l,n,l,n,l,n,l,n,l,n,l,n,l,n,l,n,l,n,l,n,l,n,l,n,l,n,l,n,l,n,l,n,l,l,l,l,l,l,l,l,l,l,l,l,l,l,l,l,l,n,l,n,l,n,l,n,l,l,l,n,l,l,l,n]}defineBossMusicPatterns(){const e={A2:110,E2:82.41,F2:87.31,G2:98,A3:220,B3:246.94,C4:261.63,D4:293.66,E4:329.63,F4:349.23,Gs4:415.3,A4:440},t=0;this.bossLeadMelody=[e.A4,e.A4,t,e.Gs4,t,e.A4,t,e.E4,e.F4,e.F4,t,e.E4,t,e.D4,t,e.C4,e.A4,e.A4,t,e.Gs4,t,e.A4,t,e.E4,e.F4,t,e.E4,t,e.D4,t,e.C4,t,e.A4,e.A4,t,e.Gs4,t,e.A4,t,e.E4,e.F4,e.F4,t,e.E4,t,e.D4,t,e.C4,e.B3,e.C4,e.D4,e.E4,e.F4,e.E4,e.D4,e.C4,e.B3,t,t,t,t,t,t,t],this.bossBassLine=[...Array(16).fill(e.A2),...Array(16).fill(e.G2),...Array(16).fill(e.F2),...Array(16).fill(e.E2)];const s=[e.A3,e.C4,e.E4,e.C4],i=[e.G2,e.B3,e.D4,e.B3],a=[e.F2,e.A3,e.C4,e.A3],r=[e.E2,e.Gs4,e.B3,e.Gs4];this.bossArpeggioMelody=[...s,...s,...s,...s,...i,...i,...i,...i,...a,...a,...a,...a,...r,...r,...r,...r];const o=!0,h=!0,l=!0,n=!1,d=(f,q)=>Array(q).fill(f).flat();this.bossKickPattern=d([o,o,n,n,o,n,n,n,o,o,n,n,o,n,n,o],4),this.bossSnarePattern=d([n,n,n,n,h,n,n,n,n,n,n,n,h,n,h,n],4),this.bossHihatPattern=d([l,l,l,l,l,l,l,l,l,l,l,l,l,l,l,l],4)}setTrack(e){!this.audioCtx||this.currentTrack===e||(this.currentTrack=e,this.musicPlaying&&(this.currentStep=0,this.nextNoteTime=this.audioCtx.currentTime))}playNote(e,t,s,i,a=1){if(!this.audioCtx||!this.masterGain||e===0)return;const r=this.audioCtx.createOscillator(),o=this.audioCtx.createGain();r.connect(o),o.connect(this.masterGain),r.type=i,r.frequency.setValueAtTime(e,t);const h=a*this.uiManager.settings.masterVolume;o.gain.setValueAtTime(h,t),o.gain.exponentialRampToValueAtTime(1e-4,t+s),r.start(t),r.stop(t+s)}playDrum(e,t){if(!this.audioCtx||!this.masterGain)return;const s=this.audioCtx.createBufferSource(),i=this.audioCtx.sampleRate*.2,a=this.audioCtx.createBuffer(1,i,this.audioCtx.sampleRate),r=a.getChannelData(0);for(let f=0;f<i;f++)r[f]=Math.random()*2-1;s.buffer=a;const o=this.audioCtx.createBiquadFilter(),h=this.audioCtx.createGain();s.connect(o),o.connect(h),h.connect(this.masterGain);const l=this.uiManager.settings.masterVolume;let n=.1,d=l;switch(e){case"kick":o.type="lowpass",o.frequency.setValueAtTime(120,t),d*=1,n=.15;break;case"snare":o.type="highpass",o.frequency.setValueAtTime(1500,t),d*=.8,n=.1;break;case"hihat":o.type="highpass",o.frequency.setValueAtTime(8e3,t),d*=.4,n=.05;break}h.gain.setValueAtTime(d,t),h.gain.exponentialRampToValueAtTime(.001,t+n),s.start(t),s.stop(t+n)}scheduler(){if(!(!this.audioCtx||!this.musicPlaying))for(;this.nextNoteTime<this.audioCtx.currentTime+this.scheduleAheadTime;){let e,t,s,i,a,r;this.currentTrack==="boss"?[e,t,s,i,a,r]=[this.bossLeadMelody,this.bossArpeggioMelody,this.bossBassLine,this.bossKickPattern,this.bossSnarePattern,this.bossHihatPattern]:[e,t,s,i,a,r]=[this.leadMelody,this.arpeggioMelody,this.bassLine,this.kickPattern,this.snarePattern,this.hihatPattern],this.playNote(e[this.currentStep],this.nextNoteTime,this.stepDuration*.9,"square",.15),this.playNote(t[this.currentStep],this.nextNoteTime,this.stepDuration,"square",.07),this.currentStep%2===0&&this.playNote(s[this.currentStep],this.nextNoteTime,this.stepDuration*1.8,"triangle",.3),i[this.currentStep]&&this.playDrum("kick",this.nextNoteTime),a[this.currentStep]&&this.playDrum("snare",this.nextNoteTime),r[this.currentStep]&&this.playDrum("hihat",this.nextNoteTime),this.nextNoteTime+=this.stepDuration,this.currentStep=(this.currentStep+1)%this.totalSteps}}toggleMusic(e){this.audioCtx&&(this.musicPlaying=e,this.musicPlaying&&this.musicScheduler===null?(this.currentStep=0,this.nextNoteTime=this.audioCtx.currentTime,this.musicScheduler=window.setInterval(()=>this.scheduler(),25)):!this.musicPlaying&&this.musicScheduler!==null&&(clearInterval(this.musicScheduler),this.musicScheduler=null))}setVolume(e){this.masterGain&&this.audioCtx&&this.masterGain.gain.setValueAtTime(e,this.audioCtx.currentTime)}play(e){if(!this.audioCtx||!this.masterGain||!this.uiManager.settings.sfx)return;let t=440,s=.1,i="sine",a=1;switch(e){case"shoot":t=880,s=.05,i="triangle",a=.4;break;case"missileLaunch":t=220,s=.3,i="sawtooth";break;case"playerHit":t=200,s=.2,i="square";break;case"playerExplosion":t=100,s=.5,i="sawtooth";break;case"enemyExplosion":t=150,s=.15,i="sawtooth",a=.5;break;case"laser":t=1500,s=.1,i="sawtooth",a=.3;break;case"powerup":t=1200,s=.1,i="sine";break;case"shieldDown":t=300,s=.2,i="square";break}const r=this.audioCtx.createOscillator(),o=this.audioCtx.createGain();r.connect(o),o.connect(this.masterGain),r.type=i,r.frequency.setValueAtTime(t,this.audioCtx.currentTime),o.gain.setValueAtTime(a*this.uiManager.settings.masterVolume,this.audioCtx.currentTime),o.gain.exponentialRampToValueAtTime(1e-4,this.audioCtx.currentTime+s),r.start(this.audioCtx.currentTime),r.stop(this.audioCtx.currentTime+s)}}class Fe{constructor(){this.currentLanguage="en",this.translations=te,this.setLanguage(localStorage.getItem("galaxyFallLanguage")||"en")}setLanguage(e){this.currentLanguage=this.translations[e]?e:"en",localStorage.setItem("galaxyFallLanguage",this.currentLanguage)}translate(e){var t,s;return((t=this.translations[this.currentLanguage])==null?void 0:t[e])||((s=this.translations.en)==null?void 0:s[e])||e}applyTranslationsToUI(){document.querySelectorAll("[data-translate-key]").forEach(e=>{const t=e.dataset.translateKey;t&&(e.textContent=this.translate(t))})}}class We{constructor(e,t){this.langSelectSource="startup",this.game=e,this.ctx=e.ctx,this.scoreEl=t.score,this.levelEl=t.level,this.highscoreEl=t.highscore,this.specialInventoryEl=t.specialInventory,this.ultraInventoryEl=t.ultraInventory,this.livesDisplay=t.livesDisplay,this.weaponStatusEl=t.weaponStatus,this.energyBarEl=t.energyBar,this.weaponTierDisplayEl=t.weaponTierDisplay,this.menuContainer=document.getElementById("menu-container"),this.gameOverContainer=document.getElementById("game-over-container"),this.langSelectScreen=document.getElementById("language-select-screen"),this.langBackButton=document.getElementById("lang-back-button"),this.tabButtons={spiel:document.getElementById("tab-spiel"),arsenal:document.getElementById("tab-arsenal"),gegner:document.getElementById("tab-gegner"),einstellungen:document.getElementById("tab-einstellungen")},this.tabPanes={spiel:document.getElementById("spiel-view"),arsenal:document.getElementById("arsenal-view"),gegner:document.getElementById("gegner-view"),einstellungen:document.getElementById("einstellungen-view")},this.mainMenuElements={resume:document.getElementById("resume-button"),restart:document.getElementById("restart-button"),quit:document.getElementById("quit-button"),header:this.menuContainer.querySelector(".menu-header h1")},this.settings=this.loadSettings(),this.localizationManager=new Fe,this.soundManager=new Ue(this),this.toggleMainMenu=this.toggleMainMenu.bind(this),this.togglePauseMenu=this.togglePauseMenu.bind(this),this.showTab=this.showTab.bind(this),this.drawLevelMessage=this.drawLevelMessage.bind(this),this.drawGameOver=this.drawGameOver.bind(this),this.drawWinScreen=this.drawWinScreen.bind(this),this.initButtons()}update(){if(this.scoreEl.textContent=this.game.score.toString(),this.levelEl.textContent=this.game.level>this.game.levelDefinitions.length?"MAX":this.game.level.toString(),(this.game.isPaused||["MENU","GAME_OVER","WIN"].includes(this.game.gameState))&&(this.highscoreEl.textContent=this.game.highscore.toString()),!this.game.player||!this.game.player.isAlive()){this.specialInventoryEl.innerHTML="",this.ultraInventoryEl.innerHTML="",this.livesDisplay.innerHTML="",this.weaponStatusEl.innerHTML="",this.energyBarEl.style.width="0%",this.weaponTierDisplayEl.innerHTML="";return}this.livesDisplay.innerHTML=`<div class="life-icon"></div><span>x${this.game.player.lives}</span>`,this.energyBarEl.style.width=`${this.game.player.energy}%`,this.updateInventoryUI(this.specialInventoryEl,this.game.player.powerUpManager.specialInventory,3,1),this.updateInventoryUI(this.ultraInventoryEl,this.game.player.powerUpManager.ultraInventory,2,4),this.updateWeaponStatusUI()}updateInventoryUI(e,t,s,i){let a="";const r=e.id==="special-inventory"?"special":"ultra";for(let o=0;o<s;o++){const h=t[o],l=i+o;if(h){const n=M[h.type];a+=`<div class="inventory-slot" data-slot-index="${o}" data-inventory-type="${r}">
                            <div class="slot-key">${l}</div>
                            <img src="${n}" class="slot-image" alt="${h.type}"/>
                            ${h.count>1?`<div class="slot-count">x${h.count}</div>`:""}
                         </div>`}else a+=`<div class="inventory-slot"><div class="slot-key">${l}</div></div>`}e.innerHTML=a}updateWeaponStatusUI(){if(!this.game.player){this.weaponTierDisplayEl.innerHTML="",this.weaponStatusEl.innerHTML="";return}const e=r=>this.localizationManager.translate(r),t=this.game.player.powerUpManager;let s=`${e("w_tier")}: ${t.weaponTier}`,i=t.weaponTierTimer;if(i>0&&t.weaponTier>1){const r=Math.ceil(i/1e3);s+=` <span class="${r<=5?"timer-warning":""}">(${r}s)</span>`}this.weaponTierDisplayEl.innerHTML=s;let a="";t.isActive("RAPID_FIRE")&&(a+=` ${e("buff_rf")}(${Math.ceil(t.timers.RAPID_FIRE/1e3)}s)`),t.isActive("SIDE_SHOTS")&&(a+=` ${e("buff_sideshots")}(${Math.ceil(t.timers.SIDE_SHOTS/1e3)}s)`),t.isActive("ORBITAL_DRONE")&&(a+=` ${e("buff_orbital")}(${this.game.player.drones.length}x) (${Math.ceil(t.timers.ORBITAL_DRONE/1e3)}s)`),a.trim()!==""?(this.weaponStatusEl.innerHTML=a.trim(),this.weaponStatusEl.style.display="block"):(this.weaponStatusEl.innerHTML="",this.weaponStatusEl.style.display="none")}toggleMainMenu(e){this.menuContainer.style.display=e?"flex":"none";const t=document.getElementById("exit-button");e&&(this.mainMenuElements.header.dataset.translateKey="main_menu_title",this.mainMenuElements.header.textContent=this.localizationManager.translate("main_menu_title"),this.mainMenuElements.resume.style.display="none",this.mainMenuElements.quit.style.display="none",t&&(t.style.display="block"),this.mainMenuElements.restart.style.display="block",this.mainMenuElements.restart.dataset.translateKey="btn_start_game",this.mainMenuElements.restart.textContent=this.localizationManager.translate("btn_start_game"),this.populateAllTranslatedContent(),this.showTab("spiel"))}togglePauseMenu(e){this.menuContainer.style.display=e?"flex":"none";const t=document.getElementById("exit-button");e&&(this.mainMenuElements.header.dataset.translateKey="pause_header",this.mainMenuElements.header.textContent=this.localizationManager.translate("pause_header"),this.mainMenuElements.resume.style.display="block",this.mainMenuElements.quit.style.display="block",t&&(t.style.display="block"),this.mainMenuElements.restart.style.display="block",this.mainMenuElements.restart.dataset.translateKey="btn_restart",this.mainMenuElements.restart.textContent=this.localizationManager.translate("btn_restart"),this.populateAllTranslatedContent(),this.showTab("spiel"))}toggleGameOverScreen(e){if(e){const t=document.getElementById("final-score");t.textContent=this.game.score.toString(),this.gameOverContainer.style.display="flex"}else this.gameOverContainer.style.display="none"}showTab(e){for(const t in this.tabPanes){const s=this.tabPanes[t],i=this.tabButtons[t];t===e?(s.classList.add("active"),i.classList.add("active")):(s.classList.remove("active"),i.classList.remove("active"))}}initButtons(){const e=this.game.isMobile?"touchstart":"click",t=(a,r)=>{a&&a.addEventListener(e,o=>{o.preventDefault(),r(o)})};t(this.mainMenuElements.restart,()=>{this.soundManager.initAudio(),this.game.changeState("LEVEL_START",!0)}),t(this.mainMenuElements.resume,()=>this.game.togglePause()),t(this.mainMenuElements.quit,()=>this.game.changeState("MENU")),t(document.getElementById("exit-button"),()=>{if(this.game.isMobile){this.menuContainer.style.display="none";const a=document.getElementById("exit-screen");a&&(a.style.display="flex"),this.soundManager.toggleMusic(!1)}else window.close()}),t(document.getElementById("restart-from-gameover-button"),()=>{this.game.changeState("LEVEL_START",!0)}),t(document.getElementById("quit-from-gameover-button"),()=>{this.game.changeState("MENU")}),t(document.getElementById("mobile-pause-button"),()=>this.game.togglePause());for(const a in this.tabButtons){const r=this.tabButtons[a];r&&t(r,()=>this.showTab(a))}const s=document.getElementById("volume-master");s&&(s.addEventListener("input",a=>{this.settings.masterVolume=parseFloat(a.target.value),this.applySettings(),this.saveSettings()}),s.value=this.settings.masterVolume.toString()),t(document.getElementById("toggle-music"),()=>{this.settings.music=!this.settings.music,this.applySettings(),this.saveSettings()}),t(document.getElementById("toggle-sfx"),()=>{this.settings.sfx=!this.settings.sfx,this.applySettings(),this.saveSettings()}),t(document.getElementById("toggle-particles"),()=>{this.settings.particles=(this.settings.particles+1)%3,this.applySettings(),this.saveSettings()}),t(document.getElementById("toggle-shake"),()=>{this.settings.screenShake=!this.settings.screenShake,this.applySettings(),this.saveSettings()}),t(document.getElementById("toggle-language"),()=>{this.langSelectSource="settings",this.menuContainer.style.display="none",this.langSelectScreen.style.display="flex",this.langBackButton.style.display="block"}),t(document.getElementById("lang-back-button"),()=>{this.langSelectScreen.style.display="none",this.menuContainer.style.display="flex",this.langSelectSource="startup"}),document.querySelectorAll(".lang-button").forEach(a=>{t(a,()=>{this.soundManager.initAudio();const r=a.dataset.lang;r&&(this.localizationManager.setLanguage(r),this.populateAllTranslatedContent(),this.langSelectScreen.style.display="none",this.langSelectSource==="settings"?this.menuContainer.style.display="flex":this.game.changeState("INTRO"))})});const i=a=>{if(!this.game.player||this.game.isPaused)return;const o=a.target.closest(".inventory-slot");if(o){const h=parseInt(o.dataset.slotIndex||"-1",10),l=o.dataset.inventoryType;h>-1&&this.game.player&&(l==="special"?this.game.player.powerUpManager.activateSpecial(h):l==="ultra"&&this.game.player.powerUpManager.activateUltra(h))}};this.specialInventoryEl&&this.specialInventoryEl.addEventListener(e,i),this.ultraInventoryEl&&this.ultraInventoryEl.addEventListener(e,i)}applySettings(){const e=i=>this.localizationManager.translate(i),t=(i,a)=>{const r=document.getElementById(i);r&&(r.textContent=a)},s=(i,a)=>{const r=document.getElementById(i);r&&r.classList.toggle("active",a)};t("toggle-language",e("lang_native_name")),t("toggle-music",this.settings.music?e("on"):e("off")),t("toggle-sfx",this.settings.sfx?e("on"):e("off")),t("toggle-particles",[e("off"),e("low"),e("high")][this.settings.particles]),t("toggle-shake",this.settings.screenShake?e("on"):e("off")),s("toggle-music",this.settings.music),s("toggle-sfx",this.settings.sfx),s("toggle-shake",this.settings.screenShake),this.soundManager.setVolume(this.settings.masterVolume),this.soundManager.toggleMusic(this.settings.music)}saveSettings(){localStorage.setItem("galaxyFallCelestialSettings",JSON.stringify(this.settings))}loadSettings(){const e=localStorage.getItem("galaxyFallCelestialSettings");return e?JSON.parse(e):{masterVolume:.5,music:!0,sfx:!0,particles:2,screenShake:!1}}populateAllTranslatedContent(){this.populateArsenal(),this.populateGegner(),this.localizationManager.applyTranslationsToUI(),this.applySettings()}createEnemyIcon(e){const t=document.createElement("canvas");t.width=60,t.height=40;const s=t.getContext("2d"),i={width:60,height:40,enemySpeedMultiplier:1,level:1,uiManager:{settings:{particles:0}}};let a=null;switch(e){case"GRUNT":a=new b(i);break;case"WEAVER":a=new S(i);break;case"TANK":a=new v(i);break;case"SHOOTER":a=new w(i);break;case"BOSS_SENTINEL_PRIME":a=new z(i,1,1);break;case"BOSS_VOID_SERPENT":a=new V(i,1,1);break;case"BOSS_OMEGA_NEXUS":a=new X(i,1,1);break;case"BOSS_NEXUS_PRIME":a=new Y(i,1,1);break}return a&&(a.width=54,a.height=36,a.pos=new u(t.width/2-a.width/2,t.height/2-a.height/2),a.draw(s)),t.toDataURL()}populateArsenal(){const e=[{c:"arsenal_cat_weapon_upgrade",n:"powerup_wup_name",d:"powerup_wup_desc",t:"WEAPON_UP"},{c:"arsenal_cat_weapon_mod",n:"powerup_rapid_fire_name",d:"powerup_rapid_fire_desc",t:"RAPID_FIRE"},{c:"arsenal_cat_weapon_mod",n:"powerup_side_shots_name",d:"powerup_side_shots_desc",t:"SIDE_SHOTS"},{c:"arsenal_cat_ultra_weapon",n:"powerup_laser_name",d:"powerup_laser_desc",t:"LASER_BEAM"},{c:"arsenal_cat_ultra_weapon",n:"powerup_homing_missiles_name",d:"powerup_homing_missiles_desc",t:"HOMING_MISSILES"},{c:"arsenal_cat_defense",n:"powerup_shield_name",d:"powerup_shield_desc",t:"SHIELD"},{c:"arsenal_cat_defense",n:"powerup_repair_kit_name",d:"powerup_repair_kit_desc",t:"REPAIR_KIT"},{c:"arsenal_cat_defense",n:"powerup_extra_life_name",d:"powerup_extra_life_desc",t:"EXTRA_LIFE"},{c:"arsenal_cat_defense",n:"powerup_ghost_protocol_name",d:"powerup_ghost_protocol_desc",t:"GHOST_PROTOCOL"},{c:"arsenal_cat_defense",n:"powerup_orbital_drone_name",d:"powerup_orbital_drone_desc",t:"ORBITAL_DRONE"},{c:"arsenal_cat_special",n:"powerup_nuke_name",d:"powerup_nuke_desc",t:"NUKE"},{c:"arsenal_cat_special",n:"powerup_black_hole_name",d:"powerup_black_hole_desc",t:"BLACK_HOLE"},{c:"arsenal_cat_special",n:"powerup_score_boost_name",d:"powerup_score_boost_desc",t:"SCORE_BOOST"}],t=document.getElementById("arsenal-list");t.innerHTML="";let s="";e.forEach(i=>{const a=this.localizationManager.translate(i.c);a!==s&&(s=a,t.innerHTML+=`<h3>- ${s} -</h3>`);const r=M[i.t];t.innerHTML+=`<div class="powerup-entry"><img src="${r}" class="arsenal-icon" alt="${i.n}"/><div class="powerup-info"><div class="powerup-title">${this.localizationManager.translate(i.n)}</div><div class="powerup-desc">${this.localizationManager.translate(i.d)}</div></div></div>`})}populateGegner(){const e=[{nameKey:"gegner_grunt_name",descKey:"gegner_grunt_desc",type:"GRUNT",strengthKey:"strength_low"},{nameKey:"gegner_weaver_name",descKey:"gegner_weaver_desc",type:"WEAVER",strengthKey:"strength_low"},{nameKey:"gegner_tank_name",descKey:"gegner_tank_desc",type:"TANK",strengthKey:"strength_medium"},{nameKey:"gegner_shooter_name",descKey:"gegner_shooter_desc",type:"SHOOTER",strengthKey:"strength_medium"},{nameKey:"gegner_sentinel_prime_name",descKey:"gegner_sentinel_prime_desc",type:"BOSS_SENTINEL_PRIME",strengthKey:"strength_high"},{nameKey:"gegner_void_serpent_name",descKey:"gegner_void_serpent_desc",type:"BOSS_VOID_SERPENT",strengthKey:"strength_extreme"},{nameKey:"gegner_omega_nexus_name",descKey:"gegner_omega_nexus_desc",type:"BOSS_OMEGA_NEXUS",strengthKey:"strength_apocalyptic"},{nameKey:"gegner_nexus_prime_name",descKey:"gegner_nexus_prime_desc",type:"BOSS_NEXUS_PRIME",strengthKey:"strength_final"}],t=i=>this.localizationManager.translate(i),s=document.getElementById("gegner-list");s.innerHTML=`<h3>- ${t("gegner_header")} -</h3>`,e.forEach(i=>{const a=this.createEnemyIcon(i.type),r=i.strengthKey.split("_")[1];s.innerHTML+=`<div class="powerup-entry"> <img src="${a}" class="arsenal-icon" alt="${t(i.nameKey)} icon"/> <div class="powerup-info"> <div class="powerup-title"> <span>${t(i.nameKey)}</span> <span class="strength-indicator strength-${r}">${t(i.strengthKey)}</span> </div> <div class="powerup-desc">${t(i.descKey)}</div> </div> </div>`})}drawLevelMessage(){const e=this.ctx;e.textAlign="center",e.fillStyle="rgba(0,0,0,0.7)",e.fillRect(0,this.game.height/2-50,this.game.width,100),e.fillStyle="#FFFF00",e.font="30px 'Press Start 2P'",e.fillText(this.game.levelMessage,this.game.width/2,this.game.height/2+10)}drawGameOver(){const e=this.ctx;e.fillStyle="rgba(0,0,0,0.7)",e.fillRect(0,0,this.game.width,this.game.height)}drawWinScreen(){const e=this.ctx,t=s=>this.localizationManager.translate(s);e.textAlign="center",e.fillStyle="rgba(0,0,0,0.7)",e.fillRect(0,0,this.game.width,this.game.height),e.fillStyle="#39FF14",e.font="50px 'Press Start 2P'",e.fillText(t("victory_title"),this.game.width/2,this.game.height/2-50),e.fillStyle="#FFF",e.font="24px 'Press Start 2P'",e.fillText(`${t("victory_final_score")}: ${this.game.score}`,this.game.width/2,this.game.height/2+20),e.font="20px 'Press Start 2P'",e.fillText(t("victory_prompt"),this.game.width/2,this.game.height/2+80)}drawOverlay(){if(this.game.isBossActive){const e=this.game.entities.find(t=>t.isBoss);e&&(this.ctx.fillStyle="red",this.ctx.fillRect(10,55,this.game.width-20,15),this.ctx.fillStyle="green",this.ctx.fillRect(10,55,(this.game.width-20)*(e.health/e.maxHealth),15))}}}class Ke{constructor(e,t){this.baseWidth=800,this.baseHeight=800,this.keys={},this.gameState="LANGUAGE_SELECT",this.isPaused=!1,this.entities=[],this.player=null,this.score=0,this.scoreEarnedThisLevel=0,this.level=1,this.highscore=0,this.isBossActive=!1,this.stars=[],this.enemySpawnTypes=[],this.enemySpawnInterval=1200,this.enemySpawnTimer=0,this.enemySpeedMultiplier=1,this.enemyHealthMultiplier=1,this.levelMessage="",this.levelScoreToEarn=0,this.isMobile=!1,this.touchX=null,this.touchY=null,this.scale=1,this.canvas=e,this.ctx=e.getContext("2d"),this.width=this.baseWidth,this.height=this.baseHeight,this.container=document.getElementById("gameContainer"),this.highscore=parseInt(localStorage.getItem("galaxyFallCelestialHighscore")||"0"),this.isMobile=/Mobi|Android|iPhone|iPad|iPod/i.test(navigator.userAgent),this.levelDefinitions=[{scoreToEarn:2e3,s:1200,m:1,e:["GRUNT"],msgKey:"wave_msg_1"},{scoreToEarn:3e3,s:1e3,m:1.1,e:["GRUNT","WEAVER"],msgKey:"wave_msg_2"},{scoreToEarn:5e3,s:900,m:1.2,e:["GRUNT","WEAVER","TANK"],msgKey:"wave_msg_3"},{scoreToEarn:8e3,s:800,m:1.3,e:["WEAVER","SHOOTER"],msgKey:"wave_msg_4"},{scoreToEarn:0,s:1e3,m:1.4,e:["BOSS_SENTINEL_PRIME"],msgKey:"wave_msg_5"},{scoreToEarn:12e3,s:700,m:1.5,e:["GRUNT","SHOOTER","SHOOTER"],msgKey:"wave_msg_6"},{scoreToEarn:15e3,s:650,m:1.6,e:["WEAVER","WEAVER","TANK"],msgKey:"wave_msg_7"},{scoreToEarn:2e4,s:600,m:1.7,e:["GRUNT","TANK","SHOOTER"],msgKey:"wave_msg_8"},{scoreToEarn:25e3,s:550,m:1.8,e:["WEAVER","SHOOTER","SHOOTER"],msgKey:"wave_msg_9"},{scoreToEarn:0,s:1e3,m:1.9,e:["BOSS_VOID_SERPENT"],msgKey:"wave_msg_10"},{scoreToEarn:3e4,s:500,m:2,e:["GRUNT","GRUNT","GRUNT","WEAVER"],msgKey:"wave_msg_11"},{scoreToEarn:3e4,s:450,m:2.1,e:["TANK","TANK","SHOOTER"],msgKey:"wave_msg_12"},{scoreToEarn:3e4,s:400,m:2.2,e:["WEAVER","WEAVER","WEAVER"],msgKey:"wave_msg_13"},{scoreToEarn:4e4,s:380,m:2.3,e:["SHOOTER","SHOOTER","TANK"],msgKey:"wave_msg_14"},{scoreToEarn:0,s:1e3,m:2.4,e:["BOSS_OMEGA_NEXUS"],msgKey:"wave_msg_15"},{scoreToEarn:6e4,s:350,m:2.5,e:["GRUNT","SHOOTER"],msgKey:"wave_msg_16"},{scoreToEarn:7e4,s:320,m:2.6,e:["WEAVER","TANK"],msgKey:"wave_msg_17"},{scoreToEarn:7e4,s:300,m:2.7,e:["GRUNT","WEAVER","TANK","SHOOTER"],msgKey:"wave_msg_18"},{scoreToEarn:8e4,s:280,m:2.8,e:["SHOOTER","SHOOTER","SHOOTER","SHOOTER"],msgKey:"wave_msg_19"},{scoreToEarn:0,s:1e3,m:3.2,e:["BOSS_NEXUS_PRIME"],msgKey:"wave_msg_20"}],this.uiManager=new We(this,t),this.initEventListeners(),this.createParallaxStarfield(),this.uiManager.populateAllTranslatedContent(),this.resizeGame(),localStorage.getItem("galaxyFallLanguage")?this.changeState("INTRO"):document.getElementById("language-select-screen").style.display="flex"}resizeGame(){const e=window.innerWidth,t=window.innerHeight,s=Math.min(e/this.baseWidth,t/this.baseHeight);this.scale=s,this.container.style.transformOrigin="top left",this.container.style.transform=`scale(${s})`,this.container.style.left=`${(e-this.baseWidth*s)/2}px`,this.container.style.top=`${(t-this.baseHeight*s)/2}px`,this.container.style.position="absolute"}initEventListeners(){window.addEventListener("resize",()=>this.resizeGame()),document.addEventListener("visibilitychange",()=>{document.visibilityState==="visible"&&this.uiManager.soundManager.audioCtx&&this.uiManager.soundManager.audioCtx.state==="suspended"&&this.uiManager.soundManager.audioCtx.resume()});const e=t=>{this.gameState==="INTRO"&&(t.preventDefault(),this.uiManager.soundManager.initAudio(),this.changeState("MENU"),window.removeEventListener("touchstart",e))};this.isMobile?(this.initMobileControls(),window.addEventListener("touchstart",e,{once:!0})):this.initDesktopControls()}initMobileControls(){const e=t=>{const s=this.canvas.getBoundingClientRect(),i=(t.touches[0].clientX-s.left)/this.scale,a=(t.touches[0].clientY-s.top)/this.scale;return{x:i,y:a}};this.canvas.addEventListener("touchstart",t=>{if(this.gameState!=="PLAYING"||this.isPaused)return;t.preventDefault(),this.uiManager.soundManager.initAudio();const s=e(t);this.touchX=s.x,this.touchY=s.y},{passive:!1}),this.canvas.addEventListener("touchmove",t=>{if(this.gameState!=="PLAYING"||this.isPaused)return;t.preventDefault();const s=e(t);this.touchX=s.x,this.touchY=s.y},{passive:!1}),this.canvas.addEventListener("touchend",t=>{t.touches.length===0&&(this.touchX=null,this.touchY=null)})}initDesktopControls(){const e={Digit1:{type:"special",index:0},Digit2:{type:"special",index:1},Digit3:{type:"special",index:2},Digit4:{type:"ultra",index:0},Digit5:{type:"ultra",index:1}};window.addEventListener("keydown",t=>{if(this.keys[t.code]=!0,t.code==="Escape"&&(this.gameState==="PLAYING"||this.isPaused)&&this.togglePause(),t.code==="Enter"&&(t.preventDefault(),this.gameState==="INTRO"?(this.uiManager.soundManager.initAudio(),this.changeState("MENU")):this.gameState==="MENU"?(this.uiManager.soundManager.initAudio(),this.changeState("LEVEL_START",!0)):["WIN"].includes(this.gameState)&&this.changeState("MENU")),this.gameState==="PLAYING"&&this.player&&!this.isPaused&&!this.player.isChargingBlackHole){const s=e[t.code];if(s&&s.type==="special"){const i=this.player.powerUpManager.specialInventory[s.index];i&&i.type==="BLACK_HOLE"&&(t.preventDefault(),this.player.isChargingBlackHole=!0,this.player.blackHoleChargeSlot=s.index)}}}),window.addEventListener("keyup",t=>{if(this.keys[t.code]=!1,this.gameState==="PLAYING"&&this.player&&!this.isPaused){const s=e[t.code];if(this.player.isChargingBlackHole&&this.player.blackHoleChargeSlot!==null){const i=Object.values(e).find(r=>r.index===this.player.blackHoleChargeSlot&&r.type==="special"),a=Object.keys(e).find(r=>e[r]===i);t.code===a&&(t.preventDefault(),this.player.powerUpManager.activateSpecial(this.player.blackHoleChargeSlot),this.player.isChargingBlackHole=!1,this.player.blackHoleChargeSlot=null)}else if(s)if(t.preventDefault(),s.type==="special"){const i=this.player.powerUpManager.specialInventory[s.index];i&&i.type!=="BLACK_HOLE"&&this.player.powerUpManager.activateSpecial(s.index)}else s.type==="ultra"&&this.player.powerUpManager.activateUltra(s.index)}})}togglePause(){this.isPaused=!this.isPaused,this.changeState(this.isPaused?"PAUSED":"PLAYING")}changeState(e,t=!1){if(!(e===this.gameState&&!t))switch(this.uiManager.toggleMainMenu(!1),this.uiManager.togglePauseMenu(!1),this.uiManager.toggleGameOverScreen(!1),e==="PAUSED"?this.isPaused=!0:this.gameState==="PAUSED"&&e!=="PAUSED"&&(this.isPaused=!1),this.gameState=e,e){case"MENU":this.entities=[],this.player=null,this.uiManager.toggleMainMenu(!0),this.uiManager.soundManager.setTrack("normal");break;case"PAUSED":this.uiManager.togglePauseMenu(!0);break;case"LEVEL_START":if(t&&(this.player=null,this.level=0),!this.player||!this.player.isAlive()?(this.level=1,this.score=0,this.player=new Ge(this),this.entities=[this.player]):this.level++,this.level>this.levelDefinitions.length){this.changeState("WIN");return}this.entities=this.entities.filter(s=>s.family==="player"||s.family==="pickup"),this.isBossActive=!1,this.scoreEarnedThisLevel=0,this.configureLevel(),this.changeState("PLAYING_TRANSITION");break;case"PLAYING_TRANSITION":setTimeout(()=>this.changeState("PLAYING"),3e3);break;case"GAME_OVER":this.score>this.highscore&&(this.highscore=this.score,localStorage.setItem("galaxyFallCelestialHighscore",this.score.toString())),this.uiManager.soundManager.setTrack("normal"),this.uiManager.toggleGameOverScreen(!0);break;case"WIN":this.score>this.highscore&&(this.highscore=this.score,localStorage.setItem("galaxyFallCelestialHighscore",this.score.toString())),this.uiManager.soundManager.setTrack("normal");break}}update(e){if(!this.isPaused){if(this.gameState!=="PLAYING"){this.gameState!=="LANGUAGE_SELECT"&&this.updateParallaxStarfield(e);return}this.updateParallaxStarfield(e),this.entities.forEach(t=>t.update(e)),this.enemySpawnTimer+=e,this.enemySpawnTimer>this.enemySpawnInterval&&!this.isBossActive&&(this.spawnEnemy(),this.enemySpawnTimer=0),!this.isBossActive&&this.levelScoreToEarn>0&&this.scoreEarnedThisLevel>=this.levelScoreToEarn&&this.changeState("LEVEL_START"),this.handleCollisions(),this.cleanupEntities(),this.player&&!this.player.isAlive()&&this.changeState("GAME_OVER"),this.uiManager.update()}}draw(){switch(this.ctx.clearRect(0,0,this.baseWidth,this.baseHeight),this.drawParallaxStarfield(),this.entities.forEach(e=>{e.draw(this.ctx)}),this.uiManager.drawOverlay(),this.gameState){case"INTRO":case"MENU":this.drawProfessionalIntro();break;case"PLAYING_TRANSITION":this.uiManager.drawLevelMessage();break;case"GAME_OVER":this.uiManager.drawGameOver();break;case"WIN":this.uiManager.drawWinScreen();break}}configureLevel(){const e=this.levelDefinitions[this.level-1];if(!e){this.changeState("WIN");return}this.enemySpawnTypes=e.e,this.enemySpawnInterval=e.s,this.enemySpeedMultiplier=e.m,this.enemyHealthMultiplier=1+Math.floor(this.level/5),this.levelMessage=this.uiManager.localizationManager.translate(e.msgKey),this.levelScoreToEarn=e.scoreToEarn,this.enemySpawnTimer=0,this.uiManager.update(),this.enemySpawnTypes.some(t=>t.includes("BOSS"))?(this.isBossActive=!0,this.spawnEnemy(),this.uiManager.soundManager.setTrack("boss")):this.uiManager.soundManager.setTrack("normal")}createParallaxStarfield(){this.stars=[];for(let e=0;e<300;e++){const t=e<100?1:e<200?2:3;this.stars.push({pos:new u(Math.random()*this.baseWidth,Math.random()*this.baseHeight),s:(4-t)*.8,v:(4-t)*24,a:1-t/4})}}updateParallaxStarfield(e){this.stars.forEach(t=>{t.pos.y+=t.v*(e/1e3),t.pos.y>this.baseHeight&&(t.pos.y=-(Math.random()*50),t.pos.x=Math.random()*this.baseWidth)})}drawParallaxStarfield(){this.stars.forEach(e=>{this.ctx.fillStyle=`rgba(255,255,255,${e.a})`,this.ctx.beginPath(),this.ctx.arc(e.pos.x,e.pos.y,e.s,0,Math.PI*2),this.ctx.fill()})}spawnEnemy(){const e=this.enemySpawnTypes[Math.floor(Math.random()*this.enemySpawnTypes.length)];let t;switch(e){case"GRUNT":t=new b(this);break;case"TANK":t=new v(this);break;case"WEAVER":t=new S(this);break;case"SHOOTER":t=new w(this);break;case"BOSS_SENTINEL_PRIME":t=new z(this,100*(1+this.level/5),1+this.level/10);break;case"BOSS_VOID_SERPENT":t=new V(this,120*(1+this.level/5),1.1+this.level/10);break;case"BOSS_OMEGA_NEXUS":t=new X(this,150*(1+this.level/5),1.2+this.level/10);break;case"BOSS_NEXUS_PRIME":t=new Y(this,200*(1+this.level/5),1.3+this.level/10);break}t&&this.addEntity(t)}drawProfessionalIntro(){const e=Date.now(),t=this.width,s=this.height,i=this.ctx;i.textAlign="center",i.font="60px 'Press Start 2P'",i.fillStyle="#0ff";const a=Math.sin(e/500)*5+15;i.shadowColor="#0ff",i.shadowBlur=a,i.fillText("GALAXY FALL",t/2,s/2);const r=i.createLinearGradient(t/2-300,0,t/2+300,0),o=e%3e3/3e3;r.addColorStop(Math.max(0,o-.2),"rgba(255,255,255,0)"),r.addColorStop(o,"rgba(255,255,255,0.8)"),r.addColorStop(Math.min(1,o+.2),"rgba(255,255,255,0)"),i.fillStyle=r,i.fillText("CELESTIAL",t/2,s/2+60),i.shadowBlur=0;const h=Math.sin(e/400)*.4+.6;i.fillStyle=`rgba(255,255,255,${h})`,i.font="20px 'Press Start 2P'";const l=this.isMobile?"intro_prompt_mobile":"intro_prompt";i.fillText(this.uiManager.localizationManager.translate(l),t/2,s/2+140)}isColliding(e,t){return e.pos.x<t.pos.x+t.width&&e.pos.x+e.width>t.pos.x&&e.pos.y<t.pos.y+t.height&&e.pos.y+e.height>t.pos.y}addEntity(e){this.entities.push(e)}cleanupEntities(){this.entities=this.entities.filter(e=>e.isAlive())}handleCollisions(){const e=this.entities.filter(a=>a.family==="projectile"),t=this.entities.filter(a=>a.family==="enemy"),s=this.player;if(!s||!s.isAlive())return;if(s.laser&&s.laser.isAlive())for(const a of t){if(!s.laser)break;this.isColliding(s.laser,a)&&(a.takeHit(s.laser.damage),this.uiManager.settings.particles>0&&s.laser&&this.addEntity(new ke(this,s.laser.pos.x+s.laser.width/2,a.pos.y,"#FF8C00")))}e.forEach(a=>{if(a instanceof c&&a.type!=="ENEMY_PROJECTILE"){for(const r of t)if(a.isAlive()&&r.isAlive()&&this.isColliding(a,r)){if(a instanceof W){a.hasHit(r)||(a.onHit(r),r.takeHit(a.damage));continue}a.onHit(r),a instanceof K||r.takeHit(a.damage);break}}}),this.entities.filter(a=>a.family==="pickup").forEach(a=>{a.isAlive()&&this.isColliding(s,a)&&a.onCollect()}),s.isGhosted()||(t.forEach(a=>{a.isAlive()&&this.isColliding(s,a)&&(a.takeHit(a.isBoss?10:999),s.takeHit(a.collisionDamage))}),this.entities.filter(a=>a.type==="ENEMY_PROJECTILE").forEach(a=>{const r=a;r.isAlive()&&this.isColliding(s,r)&&(r.destroy(),s.takeHit(r.playerDamage))}))}}window.addEventListener("load",function(){const g=document.getElementById("gameCanvas"),e={score:document.getElementById("score"),level:document.getElementById("level"),highscore:document.getElementById("highscore"),specialInventory:document.getElementById("special-inventory"),ultraInventory:document.getElementById("ultra-inventory"),livesDisplay:document.getElementById("lives-display"),weaponStatus:document.getElementById("weapon-status"),energyBar:document.getElementById("energy-bar"),weaponTierDisplay:document.getElementById("weapon-tier-display")},t=new Ke(g,e);let s=0;function i(a){s||(s=a);let r=a-s;s=a,r=Math.min(r,100),t.update(r),t.draw(),requestAnimationFrame(i)}requestAnimationFrame(i)});
